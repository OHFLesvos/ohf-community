"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[372],{6301:(t,e,r)=>{r.d(e,{Z:()=>c});var n=r(7757),i=r.n(n),a=r(7202);function s(t,e,r,n,i,a,s){try{var o=t[a](s),c=o.value}catch(t){return void r(t)}o.done?e(c):Promise.resolve(c).then(n,i)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){s(a,n,i,o,c,"next",t)}function c(t){s(a,n,i,o,c,"throw",t)}o(void 0)}))}}const c={list:function(t){return o(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,a.BC)("api.visitors.index",t),e.next=3,a.hi.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},store:function(t){return o(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,a.BC)("api.visitors.store"),e.next=3,a.hi.post(r,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},find:function(t){return o(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,a.BC)("api.visitors.show",t),e.next=3,a.hi.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},update:function(t,e){return o(i().mark((function r(){var n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=(0,a.BC)("api.visitors.update",t),r.next=3,a.hi.put(n,e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})))()},delete:function(t){return o(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,a.BC)("api.visitors.destroy",t),e.next=3,a.hi.delete(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},checkins:function(){return o(i().mark((function t(){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,a.BC)("api.visitors.checkins"),t.next=3,a.hi.get(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},checkin:function(t,e){return o(i().mark((function r(){var n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=(0,a.BC)("api.visitors.checkin",t),r.next=3,a.hi.post(n,e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})))()},dailyVisitors:function(){var t=arguments;return o(i().mark((function e(){var r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},n=(0,a.BC)("api.visitors.dailyVisitors",r),e.next=4,a.hi.get(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))()},monthlyVisitors:function(){return o(i().mark((function t(){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,a.BC)("api.visitors.monthlyVisitors"),t.next=3,a.hi.get(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()}}},7508:(t,e,r)=>{r.d(e,{Z:()=>i});const n={props:["value"]};const i=(0,r(1900).Z)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-alert",{attrs:{variant:"danger",show:null!=t.value}},[r("b-row",{attrs:{"align-v":"center"}},[r("b-col",[r("font-awesome-icon",{attrs:{icon:"times-circle"}}),t._v("\n            "+t._s(t.$t("Error: {err}",{err:t.value}))+"\n        ")],1),t._v(" "),r("b-col",{attrs:{sm:"auto"}},[r("b-button",{staticClass:"float-right",attrs:{variant:"danger",size:"sm"},on:{click:function(e){return t.$emit("retry")}}},[r("font-awesome-icon",{attrs:{icon:"redo"}}),t._v("\n                "+t._s(t.$t("Retry"))+"\n            ")],1)],1)],1)],1)}),[],!1,null,null,null).exports},184:(t,e,r)=>{r.d(e,{Z:()=>i});const n={props:{value:Number,totalRows:Number,perPage:Number,disabled:Boolean},computed:{currentPage:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},itemsStart:function(){return(this.currentPage-1)*this.perPage+1},itemsEnd:function(){return Math.min(this.currentPage*this.perPage,this.totalRows)}}};const i=(0,r(1900).Z)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-row",{staticClass:"mb-3",attrs:{"align-v":"center"}},[r("b-col",[t.totalRows>0?r("b-pagination",{staticClass:"mb-0",attrs:{size:"sm","total-rows":t.totalRows,"per-page":t.perPage,disabled:t.disabled},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()],1),t._v(" "),r("b-col",{staticClass:"text-right",attrs:{sm:"auto"}},[r("small",[t._v("\n            "+t._s(t.$t("{x} out of {y}",{x:t.itemsStart+" - "+t.itemsEnd,y:t.totalRows}))+"\n        ")])])],1)}),[],!1,null,null,null).exports},5614:(t,e,r)=>{r.d(e,{Z:()=>v});const n={props:{value:{type:String},hideLabel:Boolean,disabled:Boolean},computed:{modelValue:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{getValidationState:function(t){var e=t.dirty,r=t.validated,n=t.valid;return e||r?void 0===n?null:n:null},focus:function(){this.$refs.input.focus()}}};var i=r(629),a=r(381),s=r.n(a);function o(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const d={props:{value:{required:!1},disabled:Boolean},mixins:[n],data:function(){var t,e=this.$route.query.search,r=this.detectValueType(e);return{formData:null!==(t=this.value)&&void 0!==t?t:{name:e&&"string"==r?e:"",id_number:e&&"number"==r?e:"",gender:null,date_of_birth:e&&"date"==r?e:"",nationality:"",living_situation:""},genders:[{value:"male",text:this.$t("male")},{value:"female",text:this.$t("female")},{value:"other",text:this.$t("other")}]}},computed:l(l({},(0,i.rn)(["settings"])),{},{nationalities:function(){return[""].concat(o(this.settings["visitors.nationalities"]))},livingSituations:function(){return[""].concat(o(this.settings["visitors.living_situations"]))},age:function(){if(this.formData.date_of_birth){var t=s()(this.formData.date_of_birth,s().HTML5_FMT.DATE,!0);if(t.isValid())return""+s()().diff(t,"years")}}}),mounted:function(){this.value||this.$refs.nameInput.focus()},methods:{submit:function(){var t=this;this.$refs.observer.validate().then((function(e){e&&t.onSubmit()}))},onSubmit:function(){this.$emit("submit",this.formData)},detectValueType:function(t){return s()(t,s().DATE,!0).isValid()?"date":/\d+/.test(t)?"number":"string"},onDelete:function(){confirm(this.$t("Really delete this visitor?"))&&this.$emit("delete")}}};const v=(0,r(1900).Z)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("validation-observer",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(e){var n=e.handleSubmit;return[r("b-form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),n(t.onSubmit)}}},[r("b-form-row",[r("b-col",{attrs:{sm:""}},[r("validation-provider",{attrs:{name:t.$t("Name"),vid:"name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[r("b-form-group",{attrs:{label:t.$t("Name"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[r("b-form-input",{ref:"nameInput",attrs:{trim:"",required:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.disabled},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)]}}],null,!0)})],1),t._v(" "),r("b-col",{attrs:{sm:""}},[r("validation-provider",{attrs:{name:t.$t("ID Number"),vid:"id_number",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[r("b-form-group",{attrs:{label:t.$t("ID Number"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[r("b-form-input",{attrs:{trim:"",required:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.disabled},model:{value:t.formData.id_number,callback:function(e){t.$set(t.formData,"id_number",e)},expression:"formData.id_number"}})],1)]}}],null,!0)})],1)],1),t._v(" "),r("b-form-row",[r("b-col",{staticClass:"pr-3",attrs:{sm:""}},[r("validation-provider",{attrs:{name:t.$t("Gender"),vid:"gender",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[r("b-form-group",{attrs:{label:t.$t("Gender"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[r("b-form-radio-group",{attrs:{options:t.genders,stacked:"",disabled:t.disabled,state:t.getValidationState(e)},model:{value:t.formData.gender,callback:function(e){t.$set(t.formData,"gender",e)},expression:"formData.gender"}})],1)]}}],null,!0)})],1),t._v(" "),r("b-col",{attrs:{sm:""}},[r("validation-provider",{attrs:{name:t.$t("Date of birth"),vid:"date_of_birth",rules:{required:!0,date:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[r("b-form-group",{attrs:{label:t.$t("Date of birth"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[r("b-input-group",{attrs:{append:t.age}},[r("b-form-input",{attrs:{trim:"",autocomplete:"off",required:"",state:t.getValidationState(e),disabled:t.disabled,placeholder:"YYYY-MM-DD"},model:{value:t.formData.date_of_birth,callback:function(e){t.$set(t.formData,"date_of_birth",e)},expression:"formData.date_of_birth"}})],1)],1)]}}],null,!0)})],1)],1),t._v(" "),r("b-form-row",[r("b-col",{attrs:{sm:""}},[r("b-form-group",{attrs:{label:t.$t("Nationality")}},[r("b-form-select",{attrs:{autocomplete:"off",disabled:t.disabled,options:t.nationalities},model:{value:t.formData.nationality,callback:function(e){t.$set(t.formData,"nationality",e)},expression:"formData.nationality"}})],1)],1),t._v(" "),r("b-col",{attrs:{sm:""}},[r("b-form-group",{attrs:{label:t.$t("Living situation")}},[r("b-form-select",{attrs:{autocomplete:"off",disabled:t.disabled,options:t.livingSituations},model:{value:t.formData.living_situation,callback:function(e){t.$set(t.formData,"living_situation",e)},expression:"formData.living_situation"}})],1)],1)],1),t._v(" "),r("div",{staticClass:"d-flex justify-content-between align-items-start"},[r("span",[r("b-button",{attrs:{variant:"primary",type:"submit",disabled:t.disabled}},[r("font-awesome-icon",{attrs:{icon:"check"}}),t._v("\n                    "+t._s(t.value?t.$t("Update"):t.$t("Register"))+"\n                ")],1),t._v(" "),r("b-button",{attrs:{variant:"link"},on:{click:function(e){return t.$emit("cancel")}}},[t._v(t._s(t.$t("Cancel")))])],1),t._v(" "),t.value?r("b-button",{staticClass:"text-danger",attrs:{variant:"link",disabled:t.disabled},on:{click:t.onDelete}},[t._v("\n                "+t._s(t.$t("Delete"))+"\n            ")]):t._e()],1)],1)]}}])})}),[],!1,null,null,null).exports},9575:(t,e,r)=>{r.r(e),r.d(e,{default:()=>P});var n=r(7757),i=r.n(n),a=r(6301),s=r(7508),o=r(184);const c={props:{value:{required:!0,type:Object}},data:function(){return{visitor:this.value}},computed:{genderLabel:function(){return"male"==this.visitor.gender?this.$t("male"):"female"==this.visitor.gender?this.$t("female"):"other"==this.visitor.gender?this.$t("other"):this.visitor.gender}}};var u=r(1900);const l=(0,u.Z)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("dl",{staticClass:"row mb-0"},[t.visitor.name?[r("dt",{staticClass:"col-sm-4"},[t._v("\n            "+t._s(t.$t("Name"))+"\n        ")]),t._v(" "),r("dd",{staticClass:"col-sm-8"},[t._v("\n            "+t._s(t.visitor.name)+"\n        ")])]:t._e(),t._v(" "),t.visitor.id_number?[r("dt",{staticClass:"col-sm-4"},[t._v("\n            "+t._s(t.$t("ID Number"))+"\n        ")]),t._v(" "),r("dd",{staticClass:"col-sm-8"},[t._v("\n            "+t._s(t.visitor.id_number)+"\n        ")])]:t._e(),t._v(" "),t.visitor.gender?[r("dt",{staticClass:"col-sm-4"},[t._v("\n            "+t._s(t.$t("Gender"))+"\n        ")]),t._v(" "),r("dd",{staticClass:"col-sm-8"},[t._v("\n            "+t._s(t.genderLabel)+"\n        ")])]:t._e(),t._v(" "),t.visitor.nationality?[r("dt",{staticClass:"col-sm-4"},[t._v("\n            "+t._s(t.$t("Nationality"))+"\n        ")]),t._v(" "),r("dd",{staticClass:"col-sm-8"},[t._v("\n            "+t._s(t.visitor.nationality)+"\n        ")])]:t._e(),t._v(" "),t.visitor.date_of_birth?[r("dt",{staticClass:"col-sm-4"},[t._v("\n            "+t._s(t.$t("Date of birth"))+"\n        ")]),t._v(" "),r("dd",{staticClass:"col-sm-8"},[t._v("\n            "+t._s(t.visitor.date_of_birth)+"\n        ")])]:t._e(),t._v(" "),t.visitor.date_of_birth?[r("dt",{staticClass:"col-sm-4"},[t._v("\n            "+t._s(t.$t("Living situation"))+"\n        ")]),t._v(" "),r("dd",{staticClass:"col-sm-8"},[t._v("\n            "+t._s(t.visitor.living_situation)+"\n        ")])]:t._e()],2)}),[],!1,null,null,null).exports;var f=r(5614),d=r(629),v=r(1581);function p(t,e,r,n,i,a,s){try{var o=t[a](s),c=o.value}catch(t){return void r(t)}o.done?e(c):Promise.resolve(c).then(n,i)}function m(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){y(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function y(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const g={props:{value:{required:!0,type:Object}},data:function(){return{visitor:this.value,isBusy:!1,open:!1,formData:{purpose_of_visit:""}}},computed:_(_({},(0,d.rn)(["settings"])),{},{purposesOfVisit:function(){return[""].concat(m(this.settings["visitors.purposes_of_visit"]))}}),methods:{checkin:function(t){var e,r=this;return(e=i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isBusy=!0,e.prev=1,e.next=4,a.Z.checkin(t.id,r.formData);case 4:n=e.sent,r.$emit("checkin",n.checked_in_today),t.checked_in_today=!0,(0,v.OV)("Checked in ".concat(t.name,".")),r.open=!1,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),alert(e.t0);case 14:r.isBusy=!1;case 15:case"end":return e.stop()}}),e,null,[[1,11]])})),function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(t){p(a,n,i,s,o,"next",t)}function o(t){p(a,n,i,s,o,"throw",t)}s(void 0)}))})()}}};const w=(0,u.Z)(g,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.open&&!t.visitor.checked_in_today?r("div",[r("b-form-group",{attrs:{label:t.$t("Purpose of visit")}},[r("b-form-select",{attrs:{autocomplete:"off",disabled:t.isBusy,options:t.purposesOfVisit},model:{value:t.formData.purpose_of_visit,callback:function(e){t.$set(t.formData,"purpose_of_visit",e)},expression:"formData.purpose_of_visit"}})],1),t._v(" "),r("b-button",{attrs:{variant:"success",disabled:t.isBusy},on:{click:function(e){return t.checkin(t.visitor)}}},[r("font-awesome-icon",{attrs:{icon:"calendar-check"}}),t._v("\n        "+t._s(t.$t("Check-in")))],1),t._v(" "),r("b-button",{attrs:{variant:"link",disabled:t.isBusy},on:{click:function(e){t.open=!1}}},[t._v(t._s(t.$t("Cancel")))])],1):r("div",{staticClass:"d-flex justify-content-between"},[t.visitor.checked_in_today?r("b-button",{attrs:{variant:"secondary",disabled:""}},[t._v(t._s(t.$t("Checked-in today")))]):r("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.open=!0}}},[r("font-awesome-icon",{attrs:{icon:"calendar-check"}}),t._v("\n        "+t._s(t.$t("Check-in")))],1),t._v(" "),t._t("append")],2)}),[],!1,null,null,null).exports;function k(t,e,r,n,i,a,s){try{var o=t[a](s),c=o.value}catch(t){return void r(t)}o.done?e(c):Promise.resolve(c).then(n,i)}function x(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function s(t){k(a,n,i,s,o,"next",t)}function o(t){k(a,n,i,s,o,"throw",t)}s(void 0)}))}}function $(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function O(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const D={components:{AlertWithRetry:s.Z,TablePagination:o.Z,VisitorDetails:l,VisitorForm:f.Z,VisitorCheckinButton:w},data:function(){var t,e;return{search:null!==(t=null!==(e=this.$route.query.search)&&void 0!==e?e:sessionStorage.getItem("visitors.checkin.filter"))&&void 0!==t?t:"",visitors:[],searched:!1,isBusy:!1,currentPage:1,perPage:10,totalRows:0,errorText:null,checkedInToday:null,timer:null,showRegistrationForm:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},(0,d.rn)(["settings"])),watch:{search:{immediate:!0,handler:function(t){this.searched=!1,t.length>0?(this.$router.replace({query:{search:t}}),this.searchVisitors(),sessionStorage.setItem("visitors.checkin.filter",this.search)):(this.$router.replace({query:{search:void 0}}),this.visitors=[],sessionStorage.removeItem("visitors.checkin.filter"))}},currentPage:function(){this.searchVisitors()}},created:function(){var t=this;return x(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fetchCheckins(),t.timer=setInterval(t.fetchCheckins,6e4);case 2:case"end":return e.stop()}}),e)})))()},beforeRouteLeave:function(t,e,r){this.timer&&clearInterval(this.timer),r()},methods:{fetchCheckins:function(){var t=this;return x(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.Z.checkins();case 3:r=e.sent,t.checkedInToday=r.checked_in_today,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},searchVisitors:function(){var t=this;return x(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isBusy=!0,t.errorText=null,e.prev=2,e.next=5,a.Z.list({filter:t.search,page:t.currentPage,pageSize:t.perPage});case 5:r=e.sent,t.visitors=r.data,t.totalRows=r.meta.total,t.searched=!0,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),t.errorText=e.t0;case 14:t.isBusy=!1;case 15:case"end":return e.stop()}}),e,null,[[2,11]])})))()},handleCreate:function(t){var e=this;return x(i().mark((function r(){var n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.isBusy=!0,r.prev=1,r.next=4,a.Z.store(t);case 4:n=r.sent,e.visitors.push(n.data),(0,v.OV)(e.$t("Visitor registered.")),e.showRegistrationForm=!1,r.next=13;break;case 10:r.prev=10,r.t0=r.catch(1),alert(r.t0);case 13:e.isBusy=!1;case 14:case"end":return r.stop()}}),r,null,[[1,10]])})))()}}};const P=(0,u.Z)(D,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[r("div",{staticClass:"d-flex justify-content-between align-items-center"},[r("h2",{staticClass:"display-4 mb-3"},[t._v(t._s(t.$t("Visitor check-in")))]),t._v(" "),null!==t.checkedInToday?r("span",[t._v(t._s(t.$t("{count} check-ins today",{count:t.checkedInToday}))+"\n        ")]):t._e()]),t._v(" "),r("b-form-group",[r("b-form-input",{attrs:{type:"search",debounce:"500",placeholder:t.$t("Search visitor name, ID number or date of birth…"),autofocus:"",autocomplete:"off"},model:{value:t.search,callback:function(e){t.search="string"==typeof e?e.trim():e},expression:"search"}})],1),t._v(" "),r("alert-with-retry",{attrs:{value:t.errorText},on:{retry:function(e){return t.searchVisitors()}}}),t._v(" "),t.searched?[t.visitors.length>0?[t._l(t.visitors,(function(e){return r("b-card",{key:e.id,staticClass:"mb-3 shadow-sm",scopedSlots:t._u([{key:"footer",fn:function(){return[r("VisitorCheckinButton",{attrs:{value:e},on:{checkin:function(e){t.checkedInToday=e}},scopedSlots:t._u([{key:"append",fn:function(){return[r("b-button",{attrs:{variant:"secondary",to:{name:"visitors.edit",params:{id:e.id}}}},[r("font-awesome-icon",{attrs:{icon:"edit"}}),t._v("\n                                "+t._s(t.$t("Edit")))],1)]},proxy:!0}],null,!0)})]},proxy:!0}],null,!0)},[r("VisitorDetails",{attrs:{value:e}})],1)})),t._v(" "),t.totalRows>t.perPage?r("table-pagination",{attrs:{"total-rows":t.totalRows,"per-page":t.perPage,disabled:t.isBusy},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()]:[r("b-alert",{attrs:{variant:"warning",show:""}},[t._v(t._s(t.$t("No results.")))])],t._v(" "),t.showRegistrationForm?r("b-card",{staticClass:"mb-3",attrs:{header:t.$t("Register new visitor")}},[r("VisitorForm",{attrs:{disabled:t.isBusy},on:{submit:t.handleCreate,cancel:function(e){t.showRegistrationForm=!1}}})],1):r("p",[r("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.showRegistrationForm=!0}}},[r("font-awesome-icon",{attrs:{icon:"plus-circle"}}),t._v("\n                "+t._s(t.$t("Register new visitor")))],1)],1)]:r("p",{staticClass:"text-muted text-center"},[r("small",[t._v("\n            "+t._s(t.$t("Inactive visitor records will be anonymized after {days} days.",{days:t.settings["visitors.retention_days"]}))+"\n        ")])])],2)}),[],!1,null,null,null).exports},8534:(t,e,r)=>{r.r(e),r.d(e,{default:()=>f});var n=r(7757),i=r.n(n),a=r(6301),s=r(5614),o=r(1581);function c(t,e,r,n,i,a,s){try{var o=t[a](s),c=o.value}catch(t){return void r(t)}o.done?e(c):Promise.resolve(c).then(n,i)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function s(t){c(a,n,i,s,o,"next",t)}function o(t){c(a,n,i,s,o,"throw",t)}s(void 0)}))}}const l={components:{VisitorForm:s.Z},props:{id:{required:!0}},data:function(){return{isBusy:!1,visitor:null}},created:function(){var t=this;return u(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fetch();case 1:case"end":return e.stop()}}),e)})))()},methods:{fetch:function(){var t=this;return u(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.Z.find(t.id);case 3:r=e.sent,t.visitor=r.data,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),alert(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},handleUpdate:function(t){var e=this;return u(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.isBusy=!0,r.prev=1,r.next=4,a.Z.update(e.id,t);case 4:(0,o.OV)(e.$t("Visitor updated.")),e.$router.push({name:"visitors.check_in"}),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),alert(r.t0);case 11:e.isBusy=!1;case 12:case"end":return r.stop()}}),r,null,[[1,8]])})))()},handleDelete:function(){var t=this;return u(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isBusy=!0,e.prev=1,e.next=4,a.Z.delete(t.id);case 4:(0,o.OV)(t.$t("Visitor deleted.")),t.$router.push({name:"visitors.check_in"}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(e.t0);case 11:t.isBusy=!1;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))()},handleCancel:function(){this.$router.push({name:"visitors.check_in"})}}};const f=(0,r(1900).Z)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.visitor?r("b-container",{staticClass:"mb-3"},[r("h2",{staticClass:"display-4 mb-3"},[t._v(t._s(t.$t("Edit visitor")))]),t._v(" "),t.visitor.anonymized?r("b-alert",{attrs:{show:"",variant:"warning"}},[t._v(t._s(t.$t("This record has been anonymized.")))]):t._e(),t._v(" "),r("VisitorForm",{attrs:{value:t.visitor,disabled:t.isBusy||t.visitor.anonymized},on:{submit:t.handleUpdate,delete:t.handleDelete,cancel:t.handleCancel}})],1):r("p",[t._v("\n    "+t._s(t.$t("Loading..."))+"\n")])}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=visitors.js.map?id=7457b3b4c27fd075