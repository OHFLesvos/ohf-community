(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{7:function(e,t,n){e.exports=n("m1qI")},m1qI:function(e,t,n){"use strict";n.r(t);var r=n("XuX8"),a=n.n(r),o=n("1QPe"),s=n("X1uE"),i=n("KHd+"),l=Object(i.a)({},(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("router-view",{attrs:{name:"header"}}),this._v(" "),t("router-view")],1)}),[],!1,null,null,null).exports,u=n("g6NE"),c=n("fxIy"),d=n("jE9Z"),b=n("O55t"),p=n("fL7f"),f=n("E4rW"),m=n("sOyt"),h=n("o0o1"),v=n.n(h),k=n("7t2G");function _(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}var y={components:{TabNav:n("bZ1y").a},data:function(){return{numBorrowers:null,numLentBooks:null,tabNavItems:[{to:{name:"library.lending.index"},icon:"search",text:this.$t("library.lending"),show:Object(m.a)("operate-library")},{to:{name:"library.lending.borrowers"},icon:"users",text:this.$t("library.borrowers"),show:Object(m.a)("operate-library"),key:"borrowers"},{to:{name:"library.lending.lent_books"},icon:"inbox",text:this.$t("library.lent_books"),show:Object(m.a)("operate-library"),key:"lent_books"},{to:{name:"library.books.index"},icon:"book",text:this.$t("library.books"),show:Object(m.a)("operate-library")}]}},created:function(){var e,t=this;return(e=v.a.mark((function e(){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.fetchLendingsStatistics();case 3:n=e.sent,t.numBorrowers=n.num_borrowers,t.numLentBooks=n.num_lent_books,e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){_(o,r,a,s,i,"next",e)}function i(e){_(o,r,a,s,i,"throw",e)}s(void 0)}))})()}},g=Object(i.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("tab-nav",{attrs:{items:e.tabNavItems},scopedSlots:e._u([{key:"after(borrowers)",fn:function(){return[e.numBorrowers>0?n("b-badge",{staticClass:"ml-1"},[e._v("\n                "+e._s(e.numBorrowers)+"\n            ")]):e._e()]},proxy:!0},{key:"after(lent_books)",fn:function(){return[e.numLentBooks>0?n("b-badge",{staticClass:"ml-1"},[e._v("\n                "+e._s(e.numLentBooks)+"\n            ")]):e._e()]},proxy:!0}])}),e._v(" "),n("router-view")],1)}),[],!1,null,null,null).exports,x=n("o0O0"),$=n("Q8j+"),w=n("Cezk"),B={components:{TypeAhead:n.n(w).a},props:{url:{required:!0,type:String},placeholder:{required:!1,type:String,default:null}},data:function(){return{input:"",selectedItem:null}},watch:{input:function(e){this.selectedItem&&this.selectedItem.value!=e&&(this.selectedItem=null)},selectedItem:function(e){this.$emit("select",e?e.data:null)}},methods:{onHit:function(e,t,n){n>=0&&(this.selectedItem=t.data[n]),t.query=e},render:function(e){return e.map((function(e){return e.value}))},getResponse:function(e){return e.data.suggestions},fetch:function(e){return $.a.get(e)}}},I=Object(i.a)(B,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("type-ahead",{attrs:{src:e.url,fetch:e.fetch,getResponse:e.getResponse,limit:10,onHit:e.onHit,render:e.render,placeholder:e.placeholder},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})}),[],!1,null,null,null).exports,L={components:{AutocompleteInput:I}},O=Object(i.a)(L,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("autocomplete-input",{attrs:{placeholder:e.$t("people.search_existing_person"),url:e.route("api.people.filterPersons")+"?query=:keyword"},on:{select:function(t){return e.$emit("select",t)}}})}),[],!1,null,null,null).exports,j={props:{availableOnly:Boolean},components:{AutocompleteInput:I},computed:{url:function(){var e="".concat(this.route("api.library.books.filter"),"?query=:keyword");return this.availableOnly&&(e+="&available=true"),e}}},P=Object(i.a)(j,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("autocomplete-input",{attrs:{placeholder:e.$t("library.search_title_author_isbn"),url:e.url},on:{select:function(t){return e.$emit("select",t)}}})}),[],!1,null,null,null).exports,V=n("o0Hb"),S={props:{value:{required:!0},hideLabel:Boolean},data:function(){return{modelValue:this.value,label:this.$t("people.name"),state:null}},computed:{invalidFeedback:function(){return this.$t("validation.required",{attribute:this.label})}},watch:{modelValue:function(e){this.$emit("input",e),this.state=this.$refs.input.checkValidity()}},methods:{focus:function(){this.$refs.input.focus()}}},E=Object(i.a)(S,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.state,"invalid-feedback":e.invalidFeedback}},[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:e.hideLabel?e.label:null,autocomplete:"off",required:"",state:e.state},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)}),[],!1,null,null,null).exports,T={props:{value:{required:!0},hideLabel:Boolean},data:function(){return{modelValue:this.value,label:this.$t("people.family_name"),state:null}},computed:{invalidFeedback:function(){return this.$t("validation.required",{attribute:this.label})}},watch:{modelValue:function(e){this.$emit("input",e),this.state=this.$refs.input.checkValidity()}},methods:{focus:function(){this.$refs.input.focus()}}},C=Object(i.a)(T,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.state,"invalid-feedback":e.invalidFeedback}},[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:e.hideLabel?e.label:null,autocomplete:"off",required:"",state:e.state},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)}),[],!1,null,null,null).exports,M=n("VCnd"),D={props:{value:{required:!0},hideLabel:Boolean},data:function(){return{modelValue:this.value,label:this.$t("people.date_of_birth"),state:null}},computed:{age:function(){return this.modelValue&&Object(x.d)(this.modelValue)?Object(x.b)(this.modelValue):null},invalidFeedback:function(){return this.modelValue,this.$refs.input&&this.$refs.input.validity.patternMismatch?this.$t("validation.regex",{attribute:this.label}):this.$t("validation.required",{attribute:this.label})}},watch:{modelValue:function(e){this.$emit("input",e),this.state=this.$refs.input.checkValidity()}},methods:{focus:function(){this.$refs.input.focus()}}},q=Object(i.a)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.state,"invalid-feedback":e.invalidFeedback}},[n("b-input-group",{attrs:{append:e.$t("people.age_n",{age:null!=e.age?e.age:"..."})}},[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:"YYYY-MM-DD",autocomplete:"off",pattern:"[0-9]{4}-[0-9]{2}-[0-9]{2}",required:"",state:e.state},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)],1)}),[],!1,null,null,null).exports,F=n("+MZ5");function A(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}var N={props:{value:{required:!0},hideLabel:Boolean},data:function(){return{modelValue:this.value,label:this.$t("people.nationality"),countries:[],state:null}},computed:{invalidFeedback:function(){return this.$t("validation.country_name",{attribute:this.label})}},watch:{modelValue:function(e){this.$emit("input",e),this.state=this.$refs.input.checkValidity()&&(!e||this.countries.indexOf(e)>=0)}},created:function(){var e,t=this;return(e=v.a.mark((function e(){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.a.listCountries("en");case 2:n=e.sent,t.countries=Object.values(n);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){A(o,r,a,s,i,"next",e)}function i(e){A(o,r,a,s,i,"throw",e)}s(void 0)}))})()},methods:{focus:function(){this.$refs.input.focus()}}},R=Object(i.a)(N,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.state,"invalid-feedback":e.invalidFeedback}},[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:e.hideLabel?e.label:null,list:"country-list",state:e.state},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}}),e._v(" "),n("b-form-datalist",{attrs:{id:"country-list",options:e.countries}})],1)}),[],!1,null,null,null).exports,X={props:{value:{required:!0},hideLabel:Boolean},data:function(){return{modelValue:this.value,label:this.$t("people.police_number"),state:null}},computed:{invalidFeedback:function(){return this.$t("validation.numeric",{attribute:this.label})}},watch:{modelValue:function(e){this.$emit("input",e),this.state=this.$refs.input.checkValidity()}},methods:{focus:function(){this.$refs.input.focus()}}},H=Object(i.a)(X,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.state,"invalid-feedback":e.invalidFeedback}},[n("b-input-group",{attrs:{prepend:"05/"}},[n("b-form-input",{ref:"input",attrs:{number:"",placeholder:e.hideLabel?e.label:null,type:"number",autocomplete:"off","no-wheel":"",state:e.state},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)],1)}),[],!1,null,null,null).exports,z={components:{NameInput:E,FamilyNameInput:C,GenderRadioInput:M.a,DateOfBirthInput:q,NationalityInput:R,PoliceNumberInput:H},props:{value:{type:Object,required:!1,default:function(){return{}}}},data:function(){return{person:{name:this.value.name,family_name:this.value.family_name,gender:this.value.gender,date_of_birth:this.value.date_of_birth,nationality:this.value.nationality,police_no:this.value.police_no}}},methods:{focus:function(){this.$refs.focusThis.focus()},submit:function(){this.checkFormValidity()?this.$emit("submit",this.person):alert(this.$t("app.validation_failed"))},checkFormValidity:function(){return this.$refs.form.checkValidity()},reset:function(){this.person={}}}};function U(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}var Y={components:{PersonEditorForm:Object(i.a)(z,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{ref:"form",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.submit()}}},[n("div",{staticClass:"form-row"},[n("div",{staticClass:"col-md"},[n("name-input",{ref:"focusThis",attrs:{"hide-label":""},model:{value:e.person.name,callback:function(t){e.$set(e.person,"name",t)},expression:"person.name"}})],1),e._v(" "),n("div",{staticClass:"col-md"},[n("family-name-input",{attrs:{"hide-label":""},model:{value:e.person.family_name,callback:function(t){e.$set(e.person,"family_name",t)},expression:"person.family_name"}})],1)]),e._v(" "),n("div",{staticClass:"form-row"},[n("div",{staticClass:"col-md"},[n("gender-radio-input",{attrs:{"hide-label":""},model:{value:e.person.gender,callback:function(t){e.$set(e.person,"gender",t)},expression:"person.gender"}})],1),e._v(" "),n("div",{staticClass:"col-md"},[n("date-of-birth-input",{attrs:{"hide-label":""},model:{value:e.person.date_of_birth,callback:function(t){e.$set(e.person,"date_of_birth",t)},expression:"person.date_of_birth"}})],1)]),e._v(" "),n("div",{staticClass:"form-row"},[n("div",{staticClass:"col-md"},[n("nationality-input",{attrs:{"hide-label":""},model:{value:e.person.nationality,callback:function(t){e.$set(e.person,"nationality",t)},expression:"person.nationality"}})],1),e._v(" "),n("div",{staticClass:"col-md"},[n("police-number-input",{attrs:{"hide-label":""},model:{value:e.person.police_no,callback:function(t){e.$set(e.person,"police_no",t)},expression:"person.police_no"}})],1)])])}),[],!1,null,null,null).exports},data:function(){return{registerModalId:"registerPersoModal",busy:!1}},methods:{open:function(){this.$bvModal.show(this.registerModalId)},focusForm:function(){this.$refs.editor.focus()},handleOk:function(e){e.preventDefault(),this.$refs.editor.submit()},createPerson:function(e){var t,n=this;return(t=v.a.mark((function t(){var r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.busy=!0,t.prev=1,t.next=4,V.a.store(e);case 4:r=t.sent,Object(x.g)(r.message),n.$nextTick((function(){n.$bvModal.hide(n.registerModalId)})),n.$router.push({name:"library.lending.person",params:{personId:r.id}}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),alert(n.$t("app.error_err",{err:t.t0}));case 13:n.busy=!1;case 14:case"end":return t.stop()}}),t,null,[[1,10]])})),function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(e){U(o,r,a,s,i,"next",e)}function i(e){U(o,r,a,s,i,"throw",e)}s(void 0)}))})()}}},Z={components:{PersonAutocompleteInput:O,LibraryBookAutocompleteInput:P,PersonRegisterModal:Object(i.a)(Y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{attrs:{id:e.registerModalId,title:e.$t("people.register_new_person"),"body-class":"pb-0",centered:"","ok-only":"","ok-disabled":e.busy},on:{shown:e.focusForm,ok:e.handleOk},scopedSlots:e._u([{key:"modal-ok",fn:function(){return[n("font-awesome-icon",{attrs:{icon:"check"}}),e._v("\n        "+e._s(e.$t("app.register"))+"\n    ")]},proxy:!0}])},[n("person-editor-form",{ref:"editor",on:{submit:e.createPerson}})],1)}),[],!1,null,null,null).exports},methods:{ucFirst:x.i,navigateToPerson:function(e){e&&this.$router.push({name:"library.lending.person",params:{personId:e}})},navigateToBook:function(e){e&&this.$router.push({name:"library.lending.book",params:{bookId:e}})},registerPerson:function(){this.$refs.registerPersonModal.open()}}},G=Object(i.a)(Z,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-3"},[n("b-row",[n("b-col",{attrs:{md:""}},[n("b-card",{staticClass:"mb-4 shadow-sm",attrs:{header:e.ucFirst(e.$t("people.persons")),"body-class":"pb-4"}},[n("b-form-row",[n("b-col",[n("person-autocomplete-input",{on:{select:e.navigateToPerson}})],1),e._v(" "),n("b-col",{attrs:{cols:"auto"}},[n("b-button",{attrs:{variant:"outline-secondary"},on:{click:function(t){return e.registerPerson()}}},[n("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v(" "),n("span",{staticClass:"d-none d-sm-inline"},[e._v(e._s(e.$t("app.register")))])],1)],1)],1)],1)],1),e._v(" "),n("b-col",{attrs:{md:""}},[n("b-card",{staticClass:"mb-4 shadow-sm",attrs:{header:e.$t("library.books"),"body-class":"pb-4"}},[n("library-book-autocomplete-input",{on:{select:e.navigateToBook}})],1)],1)],1),e._v(" "),n("person-register-modal",{ref:"registerPersonModal"})],1)}),[],!1,null,null,null).exports,J=n("D52m"),Q={components:{BaseTable:J.a},data:function(){return{fields:[{key:"person",label:this.$t("people.person")},{key:"lendings_count",label:this.$t("library.books"),class:"fit text-right",tdClass:function(e,t,n){return n.lendings_overdue?"table-danger":null}}]}},methods:{listBorrowers:k.a.listBorrowers}},K=Object(i.a)(Q,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-3"},[n("base-table",{attrs:{id:"borrowersTable",fields:e.fields,"api-method":e.listBorrowers,"default-sort-by":"person","empty-text":e.$t("library.no_books_lent"),"no-filter":"","items-per-page":25},scopedSlots:e._u([{key:"cell(person)",fn:function(t){return[n("b-link",{attrs:{to:{name:"library.lending.person",params:{personId:t.item.public_id}}}},[e._v("\n                "+e._s(t.item.full_name)+"\n            ")])]}}])})],1)}),[],!1,null,null,null).exports,W=n("wd/R"),ee=n.n(W),te={components:{BaseTable:J.a},data:function(){return{fields:[{key:"book",label:this.$t("library.book")},{key:"person",label:this.$t("people.person"),class:"d-none d-sm-table-cell"},{key:"return_date",label:this.$t("library.return"),class:"fit",formatter:function(e,t,n){return ee()(n.lending.return_date).format("LL")},tdClass:function(e,t,n){return ee()(n.lending.return_date).isBefore(ee()(),"day")?"table-danger":ee()(n.lending.return_date).isSame(ee()(),"day")?"table-warning":null}}]}},methods:{listLentBooks:k.a.listLentBooks}},ne=Object(i.a)(te,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-3"},[n("base-table",{attrs:{id:"lentBooksTable",fields:e.fields,"api-method":e.listLentBooks,"default-sort-by":"book","empty-text":e.$t("library.no_books_lent"),"no-filter":"","items-per-page":25},scopedSlots:e._u([{key:"cell(book)",fn:function(t){return[n("b-link",{attrs:{to:{name:"library.lending.book",params:{bookId:t.item.id}}}},[e._v("\n                "+e._s(t.item.title)),t.item.author?[e._v(", "+e._s(t.item.author))]:e._e()],2)]}},{key:"cell(person)",fn:function(t){return[t.item.lending.person?n("b-link",{attrs:{to:{name:"library.lending.person",params:{personId:t.item.lending.person.public_id}}}},[e._v("\n                "+e._s(t.item.lending.person.full_name)+"\n            ")]):e._e()]}}])})],1)}),[],!1,null,null,null).exports,re=n("OJ8O"),ae=n("+KI5"),oe=n("Ed67"),se=n("GUe+"),ie=n("eQ0E"),le={mixins:[ie.a],props:{busy:Boolean},data:function(){return{label:this.$t("library.isbn"),vid:"isbn",rules:{regex:/^(?=[0-9X]{10}$|(?=(?:[0-9]+[- ]){3})[- 0-9X]{13}$|97[89][0-9]{10}$|(?=(?:[0-9]+[- ]){4})[- 0-9]{17}$)(?:97[89][- ]?)?[0-9]{1,5}[- ]?[0-9]+[- ]?[0-9]+[- ]?[0-9X]$/,isbn:!0}}}},ue=Object(i.a)(le,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("validation-provider",{attrs:{name:e.label,vid:e.vid,rules:e.rules},scopedSlots:e._u([{key:"default",fn:function(t){return[n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.getValidationState(t),"invalid-feedback":t.errors[0]}},[n("b-input-group",[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:e.hideLabel?e.label:null,autocomplete:"off",disabled:e.disabled,state:e.getValidationState(t),pattern:"^(?=[0-9X]{10}$|(?=(?:[0-9]+[- ]){3})[- 0-9X]{13}$|97[89][0-9]{10}$|(?=(?:[0-9]+[- ]){4})[- 0-9]{17}$)(?:97[89][- ]?)?[0-9]{1,5}[- ]?[0-9]+[- ]?[0-9]+[- ]?[0-9X]$"},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}}),e._v(" "),n("b-input-group-append",[n("b-button",{attrs:{variant:"outline-secondary",disabled:e.disabled||!(e.modelValue&&e.modelValue.length>0&&t.valid)},on:{click:function(t){return e.$emit("lookup",e.modelValue)}}},[n("font-awesome-icon",{attrs:{icon:e.busy?"spinner":"search",spin:e.busy}})],1)],1)],1)],1)]}}])})}),[],!1,null,null,null).exports,ce={mixins:[ie.a],data:function(){return{label:this.$t("app.title"),vid:"title",rules:{required:!0}}}},de=Object(i.a)(ce,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("validation-provider",{attrs:{name:e.label,vid:e.vid,rules:e.rules},scopedSlots:e._u([{key:"default",fn:function(t){return[n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.getValidationState(t),"invalid-feedback":t.errors[0]}},[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:e.hideLabel?e.label:null,autocomplete:"off",state:e.getValidationState(t),disabled:e.disabled,required:""},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)]}}])})}),[],!1,null,null,null).exports,be={mixins:[ie.a],data:function(){return{label:this.$t("library.author"),vid:"author",rules:{}}}},pe=Object(i.a)(be,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("validation-provider",{attrs:{name:e.label,vid:e.vid,rules:e.rules},scopedSlots:e._u([{key:"default",fn:function(t){return[n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.getValidationState(t),"invalid-feedback":t.errors[0]}},[n("b-form-input",{ref:"input",attrs:{trim:"",placeholder:e.hideLabel?e.label:null,autocomplete:"off",state:e.getValidationState(t),disabled:e.disabled},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)]}}])})}),[],!1,null,null,null).exports;function fe(e){return function(e){if(Array.isArray(e))return me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function he(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}var ve={mixins:[ie.a],props:{value:{type:String},hideLabel:Boolean},data:function(){return{label:this.$t("app.language"),vid:"language_code",rules:{},languages:[{value:null,text:this.$t("app.choose_language")}]}},created:function(){this.loadLanguages()},methods:{loadLanguages:function(){var e,t=this;return(e=v.a.mark((function e(){var n,r,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.listLanguages();case 3:r=e.sent,a=Object.entries(r).map((function(e){return{value:e[0],text:e[1]}})),(n=t.languages).push.apply(n,fe(a)),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){he(o,r,a,s,i,"next",e)}function i(e){he(o,r,a,s,i,"throw",e)}s(void 0)}))})()}}},ke=Object(i.a)(ve,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("validation-provider",{attrs:{name:e.label,vid:e.vid,rules:e.rules},scopedSlots:e._u([{key:"default",fn:function(t){return[n("b-form-group",{attrs:{label:e.hideLabel?null:e.label,state:e.getValidationState(t),"invalid-feedback":t.errors[0]}},[n("b-form-select",{ref:"input",attrs:{options:e.languages,state:e.getValidationState(t),disabled:e.disabled},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}})],1)]}}])})}),[],!1,null,null,null).exports;function _e(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}var ye={components:{BForm:oe.a,BButton:se.a,IsbnInput:ue,TitleInput:de,AuthorInput:pe,LanguageCodeInput:ke},props:{compact:Boolean,noButtons:Boolean,disabled:Boolean,book:{required:!1}},data:function(){return{isbn:this.book?this.book.isbn:"",title:this.book?this.book.title:"",author:this.book?this.book.author:"",language_code:this.book?this.book.language_code:null,searching:!1}},computed:{isDisabled:function(){return this.disabled||this.searching}},methods:{focus:function(){this.$refs.isbnInput.focus()},submit:function(){var e=this;this.$refs.observer.validate().then((function(t){t&&e.onSubmit()}))},onSubmit:function(){this.$emit("submit",{isbn:this.isbn,title:this.title,author:this.author,language_code:this.language_code})},updateDataByISBN:function(e){var t,n=this;return(t=v.a.mark((function t(){var r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.searching=!0,t.prev=1,t.next=4,k.a.findIsbn(e);case 4:r=t.sent,n.title=r.title,n.author=r.author,n.language_code=r.language,n.$nextTick((function(){this.$refs.observer.validate()})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),t.t0.response.status==ae.a.NOT_FOUND?(n.title="",n.author="",n.language_code=null):alert(Object(re.b)(t.t0));case 14:n.searching=!1;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})),function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(e){_e(o,r,a,s,i,"next",e)}function i(e){_e(o,r,a,s,i,"throw",e)}s(void 0)}))})()}}},ge=Object(i.a)(ye,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("validation-observer",{ref:"observer",scopedSlots:e._u([{key:"default",fn:function(t){var r=t.handleSubmit;return[n("b-form",{on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),r(e.onSubmit)}}},[n("isbn-input",{ref:"isbnInput",attrs:{"hide-label":e.compact,disabled:e.isDisabled,busy:e.searching},on:{lookup:e.updateDataByISBN},model:{value:e.isbn,callback:function(t){e.isbn=t},expression:"isbn"}}),e._v(" "),n("title-input",{attrs:{"hide-label":e.compact,disabled:e.isDisabled},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),n("author-input",{attrs:{"hide-label":e.compact,disabled:e.isDisabled},model:{value:e.author,callback:function(t){e.author=t},expression:"author"}}),e._v(" "),n("language-code-input",{attrs:{"hide-label":e.compact,disabled:e.isDisabled},model:{value:e.language_code,callback:function(t){e.language_code=t},expression:"language_code"}}),e._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:!e.noButtons,expression:"!noButtons"}]},[n("b-button",{attrs:{variant:"primary",type:"submit",disabled:e.isDisabled}},[n("font-awesome-icon",{attrs:{icon:"check"}}),e._v("\n                "+e._s(e.book?e.$t("app.update"):e.$t("app.register"))+"\n            ")],1),e._v(" "),e._t("default")],2)],1)]}}],null,!0)})}),[],!1,null,null,null).exports,xe={props:{lendings:{type:Array,required:!0},disabled:Boolean},methods:{moment:ee.a,isOverdue:function(e){return ee()(e.return_date).isBefore(ee()(),"day")},isSoonOverdue:function(e){return ee()(e.return_date).isSame(ee()(),"day")}}},$e=Object(i.a)(xe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.lendings.length>0?n("div",{staticClass:"table-responsive"},[n("table",{staticClass:"table table-hover shadow-sm bg-white"},[n("thead",[n("tr",[n("th",[e._v(e._s(e.$t("library.book")))]),e._v(" "),n("th",{staticClass:"d-none d-sm-table-cell"},[e._v(e._s(e.$t("library.lent")))]),e._v(" "),n("th",[e._v(e._s(e.$t("library.return")))]),e._v(" "),n("th")])]),e._v(" "),n("tbody",e._l(e.lendings,(function(t){return n("tr",{key:t.id,class:{"table-danger":e.isOverdue(t),"table-warning":e.isSoonOverdue(t)}},[n("td",{staticClass:"align-middle"},[n("b-link",{attrs:{to:{name:"library.lending.book",params:{bookId:t.book.id}}}},[e._v("\n                        "+e._s(t.book.title)+"\n                        "),t.book.author?[e._v("\n                            ("+e._s(t.book.author)+")\n                        ")]:e._e()],2)],1),e._v(" "),n("td",{staticClass:"align-middle d-none d-sm-table-cell"},[e._v("\n                    "+e._s(e.moment(t.lending_date).format("LL"))+"\n                ")]),e._v(" "),n("td",{staticClass:"align-middle"},[e._v("\n                    "+e._s(e.moment(t.return_date).format("LL"))+"\n                ")]),e._v(" "),n("td",{staticClass:"fit align-middle"},[n("b-button",{attrs:{variant:"success",size:"sm",disabled:e.disabled},on:{click:function(n){return e.$emit("return",t.book.id)}}},[n("font-awesome-icon",{attrs:{icon:"inbox"}}),e._v(" "),n("span",{staticClass:"d-none d-sm-inline"},[e._v(" "+e._s(e.$t("library.return")))])],1),e._v(" "),n("b-button",{attrs:{variant:"primary",size:"sm",disabled:e.disabled},on:{click:function(n){return e.$emit("extend",t.book.id)}}},[n("font-awesome-icon",{attrs:{icon:"calendar-plus"}}),e._v(" "),n("span",{staticClass:"d-none d-sm-inline"},[e._v(" "+e._s(e.$t("library.extend")))])],1)],1)])})),0)])]):n("b-alert",{attrs:{show:""}},[e._v("\n    "+e._s(e.$t("library.no_books_lent"))+"\n")])}),[],!1,null,null,null).exports,we={components:{BaseTable:J.a},props:{personId:{required:!0}},data:function(){return{fields:[{key:"book",label:this.$t("library.book")},{key:"lending_date",label:this.$t("library.lent"),formatter:function(e){return ee()(e).format("LL")}},{key:"returned_date",label:this.$t("library.returned"),formatter:function(e){return e?ee()(e).format("LL"):null}}]}},methods:{fetchPersonLog:function(){return k.a.fetchPersonLog(this.personId)}}};function Be(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}function Ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){Be(o,r,a,s,i,"next",e)}function i(e){Be(o,r,a,s,i,"throw",e)}s(void 0)}))}}var Le={components:{LibraryBookAutocompleteInput:P,BookForm:ge,PersonLendingsTable:$e,PersonLogTable:Object(i.a)(we,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-table",{attrs:{id:"lendingLogTable",fields:e.fields,"api-method":e.fetchPersonLog,"default-sort-by":"lending_date","default-sort-desc":"","empty-text":e.$t("library.no_books_lent_so_far"),"no-filter":"","items-per-page":25},scopedSlots:e._u([{key:"cell(book)",fn:function(t){return[n("b-link",{attrs:{to:{name:"library.lending.book",params:{bookId:t.item.book.id}}}},[e._v("\n            "+e._s(t.item.book.title)+"\n        ")])]}}])})}),[],!1,null,null,null).exports},props:{personId:{required:!0}},data:function(){return{person:null,lendings:null,canLend:!1,canRegisterBook:!1,defaultExtendDuration:0,selectedBookId:null,busy:!1}},created:function(){this.loadPerson(),this.loadLendings()},methods:{moment:ee.a,loadPerson:function(){var e=this;return Ie(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,V.a.find(e.personId);case 3:n=t.sent,e.person=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),alert(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loadLendings:function(){var e=this;return Ie(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.busy=!0,t.prev=1,t.next=4,k.a.findLendingsOfPerson(e.personId);case 4:n=t.sent,e.lendings=n.data,e.canLend=n.meta.can_lend,e.canRegisterBook=n.meta.can_register_book,e.defaultExtendDuration=n.meta.default_extend_duration,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),alert(t.t0);case 14:e.busy=!1;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},lendBookToPerson:function(e){var t=this;return Ie(v.a.mark((function n(){var r;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),!t.selectedBookId){n.next=16;break}return t.busy=!0,n.prev=3,n.next=6,k.a.lendBookToPerson(t.selectedBookId,t.personId);case 6:r=n.sent,Object(x.g)(r.message),t.loadLendings(),t.$nextTick((function(){t.$bvModal.hide("lendBookModal")})),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(3),alert(n.t0);case 15:t.busy=!1;case 16:case"end":return n.stop()}}),n,null,[[3,12]])})))()},handleOkRegisterBook:function(e){e.preventDefault(),this.$refs.registerBookForm.submit()},registerAndLendBookToPerson:function(e){var t=this;return Ie(v.a.mark((function n(){var r;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.busy=!0,n.prev=1,n.next=4,k.a.lendBookToPerson(e,t.personId);case 4:r=n.sent,Object(x.g)(r.message),t.loadLendings(),t.$nextTick((function(){t.$bvModal.hide("registerBookModal"),t.$bvModal.hide("lendBookModal")})),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),alert(n.t0);case 13:t.busy=!1;case 14:case"end":return n.stop()}}),n,null,[[1,10]])})))()},extendLending:function(e){var t=this;return Ie(v.a.mark((function n(){var r,a;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null!=(r=prompt("".concat(t.$t("app.number_of_days"),":"),t.defaultExtendDuration))&&r>0)){n.next=15;break}return t.busy=!0,n.prev=3,n.next=6,k.a.extendLendingToPerson(e,t.personId,r);case 6:a=n.sent,Object(x.g)(a.message),t.loadLendings(),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(3),alert(n.t0);case 14:t.busy=!1;case 15:case"end":return n.stop()}}),n,null,[[3,11]])})))()},returnBook:function(e){var t=this;return Ie(v.a.mark((function n(){var r;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.busy=!0,n.prev=1,n.next=4,k.a.returnBookFromPerson(e,t.personId);case 4:r=n.sent,Object(x.g)(r.message),t.loadLendings(),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),alert(n.t0);case 12:t.busy=!1;case 13:case"end":return n.stop()}}),n,null,[[1,9]])})))()}}},Oe=Object(i.a)(Le,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.person?n("div",[n("h2",{staticClass:"mb-3"},[e._v("\n        "+e._s(e.person.full_name)+"\n        "),n("small",{staticClass:"d-block d-sm-inline"},[e._v("\n            "+e._s(e.person.nationality)),e.person.nationality&&e.person.date_of_birth?[e._v(",")]:e._e(),e._v("\n            "+e._s(e.moment(e.person.date_of_birth).format("LL"))+"\n        ")],2)]),e._v(" "),n("b-tabs",{attrs:{"content-class":"mt-3"}},[n("b-tab",{attrs:{title:e.$t("library.lendings"),active:""}},[e.lendings?n("person-lendings-table",{attrs:{lendings:e.lendings,disabled:e.busy},on:{return:e.returnBook,extend:e.extendLending}}):e._e(),e._v(" "),e.canLend?n("p",[n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.lendBookModal",modifiers:{lendBookModal:!0}}],attrs:{variant:"primary",disabled:e.busy}},[n("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v("\n                    "+e._s(e.$t("library.lend_a_book"))+"\n                ")],1)],1):e._e(),e._v(" "),n("b-modal",{attrs:{id:"lendBookModal",title:e.$t("library.lend_a_book")},on:{ok:e.lendBookToPerson,hidden:function(t){e.selectedBookId=null}},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var r=t.ok;return[n("b-button",{attrs:{variant:"primary",disabled:!e.selectedBookId||e.busy},on:{click:function(e){return r()}}},[n("font-awesome-icon",{attrs:{icon:"check"}}),e._v("\n                        "+e._s(e.$t("library.lend_book"))+"\n                    ")],1),e._v(" "),e.canRegisterBook?n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.registerBookModal",modifiers:{registerBookModal:!0}}],attrs:{variant:"secondary",disabled:e.busy}},[n("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v("\n                        "+e._s(e.$t("library.new_book"))+"\n                    ")],1):e._e()]}}],null,!1,3975244277)},[n("library-book-autocomplete-input",{attrs:{"available-only":""},on:{select:function(t){e.selectedBookId=t}}})],1),e._v(" "),n("b-modal",{attrs:{id:"registerBookModal",title:e.$t("library.register_new_book"),"ok-only":"","ok-disabled":e.busy,"body-class":"pb-0"},on:{shown:function(t){return e.$refs.registerBookForm.focus()},ok:e.handleOkRegisterBook},scopedSlots:e._u([{key:"modal-ok",fn:function(){return[n("font-awesome-icon",{attrs:{icon:"check"}}),e._v("\n                    "+e._s(e.$t("library.register_and_lend_book"))+"\n                ")]},proxy:!0}],null,!1,3283505610)},[n("book-form",{ref:"registerBookForm",attrs:{compact:"","no-buttons":"",disabled:e.busy},on:{submit:e.registerAndLendBookToPerson}})],1)],1),e._v(" "),n("b-tab",{attrs:{title:e.$t("app.log"),lazy:""}},[n("person-log-table",{attrs:{"person-id":e.personId}})],1)],1)],1):n("p",[e._v("\n    "+e._s(e.$t("app.loading"))+"\n")])}),[],!1,null,null,null).exports,je={components:{BaseTable:J.a},data:function(){return{fields:[{key:"title",label:this.$t("app.title"),sortable:!0},{key:"author",label:this.$t("library.author"),sortable:!0},{key:"isbn",label:this.$t("library.isbn"),class:"d-none d-md-table-cell",sortable:!1},{key:"language",label:this.$t("app.language"),class:"d-none d-sm-table-cell",sortable:!1},{key:"created_at",label:this.$t("app.registered"),class:"d-none d-sm-table-cell fit",sortable:!0,sortDirection:"desc",formatter:function(e){return ee()(e).fromNow()}}]}},methods:{listBooks:k.a.listBooks}},Pe={components:{BooksTable:Object(i.a)(je,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-3"},[n("base-table",{attrs:{id:"booksTable",fields:e.fields,"api-method":e.listBooks,"default-sort-by":"title","empty-text":e.$t("library.no_books_registered"),"filter-placeholder":e.$t("app.search_ellipsis"),"items-per-page":100},scopedSlots:e._u([{key:"cell(title)",fn:function(t){return[n("b-link",{attrs:{to:{name:"library.lending.book",params:{bookId:t.item.id}}}},[e._v("\n                "+e._s(t.value)+"\n            ")])]}}])})],1)}),[],!1,null,null,null).exports}},Ve=Object(i.a)(Pe,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("books-table")],1)}),[],!1,null,null,null).exports;function Se(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}var Ee={components:{BookForm:ge},data:function(){return{busy:!1}},mounted:function(){this.$refs.form.focus()},methods:{registerBook:function(e){var t,n=this;return(t=v.a.mark((function t(){var r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.busy=!0,t.prev=1,t.next=4,k.a.storeBook(e);case 4:r=t.sent,Object(x.g)(r.message),n.$router.push({name:"library.lending.book",params:{bookId:r.id}}),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),alert(t.t0),n.busy=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})),function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(e){Se(o,r,a,s,i,"next",e)}function i(e){Se(o,r,a,s,i,"throw",e)}s(void 0)}))})()}}},Te=Object(i.a)(Ee,(function(){var e=this.$createElement,t=this._self._c||e;return t("b-container",{staticClass:"px-0"},[t("book-form",{ref:"form",attrs:{disabled:this.busy},on:{submit:this.registerBook}})],1)}),[],!1,null,null,null).exports;function Ce(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}function Me(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){Ce(o,r,a,s,i,"next",e)}function i(e){Ce(o,r,a,s,i,"throw",e)}s(void 0)}))}}var De={components:{BookForm:ge},props:{bookId:{required:!0}},data:function(){return{book:null,canDelete:!1,busy:!1}},created:function(){this.loadBook()},methods:{loadBook:function(){var e=this;return Me(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k.a.findBook(e.bookId);case 3:n=t.sent,e.book=n.data,e.canDelete=n.meta.can_delete,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),alert(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},updateBook:function(e){var t=this;return Me(v.a.mark((function n(){var r;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.busy=!0,n.prev=1,n.next=4,k.a.updateBook(t.bookId,e);case 4:r=n.sent,Object(x.g)(r.message),t.$router.push({name:"library.lending.book",params:{bookId:t.bookId}}),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),alert(n.t0),t.busy=!1;case 13:case"end":return n.stop()}}),n,null,[[1,9]])})))()},deleteBook:function(){var e=this;return Me(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm(e.$t("library.confirm_delete_book"))){t.next=14;break}return e.busy=!0,t.prev=2,t.next=5,k.a.deleteBook(e.bookId);case 5:n=t.sent,Object(x.g)(n.message),e.$router.push({name:"library.books.index"}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),alert(t.t0),e.busy=!1;case 14:case"end":return t.stop()}}),t,null,[[2,10]])})))()}}},qe=Object(i.a)(De,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.book?n("b-container",{staticClass:"px-0"},[n("book-form",{attrs:{book:e.book,disabled:e.busy},on:{submit:e.updateBook}},[e.canDelete?n("b-button",{attrs:{variant:"danger",type:"button",disabled:e.busy},on:{click:e.deleteBook}},[n("font-awesome-icon",{attrs:{icon:"trash"}}),e._v("\n            "+e._s(e.$t("app.delete"))+"\n        ")],1):e._e()],1)],1):n("p",[e._v("\n    "+e._s(e.$t("app.loading"))+"\n")])}),[],!1,null,null,null).exports,Fe={components:{BaseTable:J.a},props:{bookId:{required:!0}},data:function(){return{fields:[{key:"person",label:this.$t("people.person")},{key:"lending_date",label:this.$t("library.lent"),formatter:function(e){return ee()(e).format("LL")}},{key:"returned_date",label:this.$t("library.returned"),formatter:function(e){return e?ee()(e).format("LL"):null}}]}},methods:{fetchBookLog:function(){return k.a.fetchBookLog(this.bookId)}}};function Ae(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}function Ne(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){Ae(o,r,a,s,i,"next",e)}function i(e){Ae(o,r,a,s,i,"throw",e)}s(void 0)}))}}var Re={components:{PersonAutocompleteInput:O,BookLogTable:Object(i.a)(Fe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-table",{attrs:{id:"lendingLogTable",fields:e.fields,"api-method":e.fetchBookLog,"default-sort-by":"lending_date","default-sort-desc":"","empty-text":e.$t("library.not_lent_to_anyone_so_far"),"no-filter":"","items-per-page":25},scopedSlots:e._u([{key:"cell(person)",fn:function(t){return[n("b-link",{attrs:{to:{name:"library.lending.person",params:{personId:t.item.person.public_id}}}},[e._v("\n            "+e._s(t.item.person.full_name)+"\n        ")])]}}])})}),[],!1,null,null,null).exports},props:{bookId:{required:!0}},data:function(){return{book:null,lending:null,defaultExtendDuration:0,busy:!1,selectedPersonId:null}},computed:{isOverdue:function(){return ee()(this.lending.return_date).isBefore(ee()(),"day")},isSoonOverdue:function(){return ee()(this.lending.return_date).isSame(ee()(),"day")},lentToPersonMessage:function(){return this.lending.person?this.$t("library.book_is_lent_to_person_until",{person:this.lending.person.full_name,until:ee()(this.lending.return_date).format("LL")}):this.$t("library.book_is_lent_to_deleted_person_until",{until:ee()(this.lending.return_date).format("LL")})}},created:function(){this.loadBook(),this.loadLending()},methods:{moment:ee.a,loadBook:function(){var e=this;return Ne(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k.a.findBook(e.bookId);case 3:n=t.sent,e.book=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),alert(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loadLending:function(){var e=this;return Ne(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.busy=!0,t.prev=1,t.next=4,k.a.findLendingOfBook(e.bookId);case 4:(n=t.sent).data?(e.lending=n.data,e.defaultExtendDuration=n.meta.default_extend_duration):e.lending=null,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),alert(t.t0);case 11:e.busy=!1;case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},extendLending:function(){var e=this;return Ne(v.a.mark((function t(){var n,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null!=(n=prompt("".concat(e.$t("app.number_of_days"),":"),e.defaultExtendDuration))&&n>0)){t.next=15;break}return e.busy=!0,t.prev=3,t.next=6,k.a.extendLending(e.bookId,n);case 6:r=t.sent,Object(x.g)(r.message),e.loadLending(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),alert(t.t0);case 14:e.busy=!1;case 15:case"end":return t.stop()}}),t,null,[[3,11]])})))()},returnBook:function(){var e=this;return Ne(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.busy=!0,t.prev=1,t.next=4,k.a.returnBook(e.bookId);case 4:n=t.sent,Object(x.g)(n.message),e.loadLending(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),alert(t.t0);case 12:e.busy=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},lendBook:function(e){var t=this;return Ne(v.a.mark((function n(){var r;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),!t.selectedPersonId){n.next=16;break}return t.busy=!0,n.prev=3,n.next=6,k.a.lendBook(t.bookId,t.selectedPersonId);case 6:r=n.sent,Object(x.g)(r.message),t.loadLending(),t.$nextTick((function(){t.$bvModal.hide("lendBookModal")})),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(3),alert(n.t0);case 15:t.busy=!1;case 16:case"end":return n.stop()}}),n,null,[[3,12]])})))()}}},Xe=Object(i.a)(Re,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.book?n("div",[n("h2",{staticClass:"mb-3"},[e._v("\n        "+e._s(e.book.title)+"\n        "),n("small",{staticClass:"d-block d-sm-inline"},[e._v("\n            "+e._s(e.book.author)+"\n        ")])]),e._v(" "),e.book.isbn?n("p",[n("strong",[e._v(e._s(e.$t("library.isbn"))+":")]),e._v(" "+e._s(e.book.isbn)+"\n    ")]):e._e(),e._v(" "),e.book.language?n("p",[n("strong",[e._v(e._s(e.$t("app.language"))+":")]),e._v(" "+e._s(e.book.language)+"\n    ")]):e._e(),e._v(" "),n("b-tabs",{attrs:{"content-class":"mt-3"}},[n("b-tab",{attrs:{title:e.$t("library.lendings"),active:""}},[e.lending?[e.isOverdue?n("b-alert",{attrs:{variant:"danger",show:""}},[e._v("\n                    "+e._s(e.$t("library.book_is_overdue"))+"\n                ")]):e.isSoonOverdue?n("b-alert",{attrs:{variant:"warning",show:""}},[e._v("\n                    "+e._s(e.$t("library.book_is_overdue_soon"))+"\n                ")]):e._e(),e._v(" "),n("b-alert",{attrs:{variant:"info",show:""},domProps:{innerHTML:e._s(e.lentToPersonMessage)}}),e._v(" "),n("p",[n("b-button",{attrs:{to:{name:"library.lending.person",params:{personId:e.lending.person.public_id}},variant:"primary"}},[n("font-awesome-icon",{attrs:{icon:"user"}}),e._v("\n                        "+e._s(e.$t("library.borrower"))+"\n                    ")],1),e._v(" "),n("b-button",{attrs:{variant:"success",disabled:e.busy},on:{click:e.returnBook}},[n("font-awesome-icon",{attrs:{icon:"inbox"}}),e._v("\n                        "+e._s(e.$t("library.return"))+"\n                    ")],1),e._v(" "),n("b-button",{attrs:{variant:"primary",disabled:e.busy},on:{click:e.extendLending}},[n("font-awesome-icon",{attrs:{icon:"calendar-plus"}}),e._v("\n                        "+e._s(e.$t("library.extend"))+"\n                    ")],1)],1)]:[n("b-alert",{attrs:{variant:"success"}},[e._v("\n                    "+e._s(e.$t("library.book_is_available"))+"\n                ")]),e._v(" "),n("p",[n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.lendBookModal",modifiers:{lendBookModal:!0}}],attrs:{variant:"primary",disabled:e.busy}},[n("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v("\n                        "+e._s(e.$t("library.lend_book"))+"\n                    ")],1)],1),e._v(" "),n("b-modal",{attrs:{id:"lendBookModal",title:e.$t("library.lend_book")},on:{ok:e.lendBook,hidden:function(t){e.selectedPersonId=null}},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var r=t.ok;return[n("b-button",{attrs:{variant:"primary",disabled:!e.selectedPersonId||e.busy},on:{click:function(e){return r()}}},[n("font-awesome-icon",{attrs:{icon:"check"}}),e._v("\n                            "+e._s(e.$t("library.lend_book"))+"\n                        ")],1)]}}],null,!1,2627905039)},[n("person-autocomplete-input",{on:{select:function(t){e.selectedPersonId=t}}})],1)]],2),e._v(" "),n("b-tab",{attrs:{title:e.$t("app.log"),lazy:""}},[n("book-log-table",{attrs:{"book-id":e.bookId}})],1)],1)],1):n("p",[e._v("\n    "+e._s(e.$t("app.loading"))+"\n")])}),[],!1,null,null,null).exports,He=n("Ajch");function ze(e,t,n,r,a,o,s){try{var i=e[o](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}function Ue(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){ze(o,r,a,s,i,"next",e)}function i(e){ze(o,r,a,s,i,"throw",e)}s(void 0)}))}}var Ye={data:function(){return{loaded:!1,form:{format:null,selection:null},isBusy:!1,formats:null,selections:null}},created:function(){var e=this;return Ue(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k.a.fetchExportData();case 3:n=t.sent,e.form.format=n.format,e.form.selection=n.selection,e.formats=Object.entries(n.formats).map((function(e){return{value:e[0],text:e[1]}})),e.selections=Object.entries(n.selections).map((function(e){return{value:e[0],text:e[1]}})),e.loaded=!0,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),alert(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()},methods:{onSubmit:function(){var e=this;return Ue(v.a.mark((function t(){return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isBusy=!0;try{Object(He.a)(e.route("api.library.doExport"),e.form)}catch(e){alert(e)}e.isBusy=!1;case 3:case"end":return t.stop()}}),t)})))()}}},Ze=Object(i.a)(Ye,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.loaded?n("b-form",{on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.onSubmit(t)}}},[n("b-form-group",{attrs:{label:e.$t("app.file_format")}},[n("b-form-radio-group",{attrs:{options:e.formats,stacked:""},model:{value:e.form.format,callback:function(t){e.$set(e.form,"format",t)},expression:"form.format"}})],1),e._v(" "),n("b-form-group",{attrs:{label:e.$t("app.selection")}},[n("b-form-radio-group",{attrs:{options:e.selections,stacked:""},model:{value:e.form.selection,callback:function(t){e.$set(e.form,"selection",t)},expression:"form.selection"}})],1),e._v(" "),n("p",[n("b-button",{attrs:{type:"submit",variant:"primary",disabled:e.isBusy}},[n("font-awesome-icon",{attrs:{icon:"download"}}),e._v("\n            "+e._s(e.$t("app.export"))+"\n        ")],1)],1)],1):n("p",[e._v("\n    "+e._s(e.$t("app.loading"))+"\n")])}),[],!1,null,null,null).exports;a.a.use(d.a);var Ge=new d.a({mode:"history",base:"/library/"});Ge.addRoutes([{path:"/",redirect:{name:"library.lending.index"}},{path:"/lending",components:{default:g,header:p.a},props:{header:{title:c.a.t("app.overview"),buttons:[{to:{name:"library.books.create"},variant:"primary",icon:"plus-circle",text:c.a.t("library.register_new_book"),show:Object(m.a)("create-books")},{to:{name:"library.export"},icon:"download",text:c.a.t("app.export"),show:Object(m.a)("operate-library")}]}},children:[{path:"",name:"library.lending.index",component:G},{path:"borrowers",name:"library.lending.borrowers",component:K},{path:"lent_books",name:"library.lending.lent_books",component:ne},{path:"/books",name:"library.books.index",component:Ve}]},{path:"/lending/person/:personId",name:"library.lending.person",components:{default:Oe,header:p.a},props:{default:!0,header:function(e){return{title:c.a.t("people.person"),buttons:[{href:Object(b.a)("people.show",e.params.personId),icon:"users",text:c.a.t("people.view_person")},{to:{name:"library.lending.index"},icon:"times-circle",text:c.a.t("app.close"),show:Object(m.a)("operate-library")}]}}}},{path:"/lending/book/:bookId(\\d+)",name:"library.lending.book",components:{default:Xe,header:p.a},props:{default:!0,header:function(e){return{title:c.a.t("library.book"),buttons:[{to:{name:"library.books.edit",params:{bookId:e.params.bookId}},icon:"edit",text:c.a.t("app.edit"),variant:"primary",show:Object(m.a)("operate-library")},{to:{name:"library.books.index"},icon:"times-circle",text:c.a.t("app.close"),show:Object(m.a)("operate-library")}]}}}},{path:"/books/create",name:"library.books.create",components:{default:Te,header:p.a},props:{header:{title:c.a.t("library.register_book"),buttons:[{click:function(){return Ge.back()},icon:"times-circle",text:c.a.t("app.cancel")}]}}},{path:"/books/:bookId(\\d+)/edit",name:"library.books.edit",components:{default:qe,header:p.a},props:{default:!0,header:{title:c.a.t("library.edit_book"),buttons:[{click:function(){return Ge.back()},icon:"times-circle",text:c.a.t("app.cancel")}]}}},{path:"/export",name:"library.export",components:{default:Ze,header:p.a},props:{header:{title:c.a.t("app.export"),buttons:[{click:function(){return Ge.back()},icon:"times-circle",text:c.a.t("app.close")}]}}},{path:"*",component:f.a}]);var Je=Ge,Qe=(n("l/fe"),n("UvZm"));a.a.component("font-awesome-icon",o.a),a.a.use(s.a),a.a.mixin(Qe.a),a.a.config.productionTip=!1,new a.a({el:"#library-app",i18n:c.a,router:Je,store:u.a,components:{LibraryApp:l}})}},[[7,0,1]]]);
//# sourceMappingURL=library.js.map