(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{3:function(t,e,a){t.exports=a("J/+j")},"J/+j":function(t,e,a){"use strict";a.r(e);var r=a("XuX8"),i=a.n(r),s=a("1QPe"),n=a("X1uE"),o=a("fxIy"),c=a("jE9Z"),u=a("o0o1"),l=a.n(u),p=a("wd/R"),f=a.n(p),d=a("K9XY"),m=a("OJ8O");function v(t,e,a,r,i,s,n){try{var o=t[s](n),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(r,i)}function b(t){return function(){var e=this,a=arguments;return new Promise((function(r,i){var s=t.apply(e,a);function n(t){v(s,r,i,n,o,"next",t)}function o(t){v(s,r,i,n,o,"throw",t)}n(void 0)}))}}var _=function(t){return b(l.a.mark((function e(){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(m.c)("api.visitors.listCurrent",t),e.next=3,m.a.get(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},h=function(t){return b(l.a.mark((function e(){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(m.c)("api.visitors.checkin"),e.next=3,m.a.post(a,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},y=function(t){return b(l.a.mark((function e(){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(m.c)("api.visitors.checkout",t),e.next=3,m.a.put(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},g=function(){return b(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Object(m.c)("api.visitors.checkoutAll"),t.next=3,m.a.post(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},k=function(){return b(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Object(m.c)("api.visitors.dailyVisitors"),t.next=3,m.a.get(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},$=function(){return b(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Object(m.c)("api.visitors.monthlyVisitors"),t.next=3,m.a.get(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},x=a("eQ0E"),w={props:{disabled:Boolean},mixins:[x.a],data:function(){return{formData:this.initialFormData(),types:[{value:"visitor",text:this.$t("visitors.visitor")},{value:"participant",text:this.$t("visitors.participant")},{value:"staff",text:this.$t("visitors.volunteer_staff")},{value:"external",text:this.$t("visitors.external_visitor")}]}},computed:{isDisabled:function(){return this.disabled}},watch:{disabled:function(t,e){var a=this;!t&&e&&this.$nextTick((function(){return a.selectFirstName()}))}},mounted:function(){this.focus()},methods:{submit:function(){var t=this;this.$refs.observer.validate().then((function(e){e&&t.onSubmit()}))},onSubmit:function(){"visitor"==this.formData.type?(this.formData.activity="",this.formData.organization=""):"participant"==this.formData.type?(this.formData.id_number="",this.formData.place_of_residence="",this.formData.organization=""):"staff"!=this.formData.type&&"external"!=this.formData.type||(this.formData.id_number="",this.formData.place_of_residence="",this.formData.activity=""),this.$emit("submit",this.formData)},reset:function(){this.formData=this.initialFormData(),this.$refs.observer.reset(),this.focus()},initialFormData:function(){return{first_name:"",last_name:"",type:"visitor",id_number:"",place_of_residence:"",activity:"",organization:""}},focus:function(){this.$refs.firstNameInput.focus()},selectFirstName:function(){this.$refs.firstNameInput.select()},changeType:function(t){var e=this;"staff"==t||"external"==t?this.$nextTick((function(){return e.$refs.organizationInput.focus()})):"participant"==t?this.$nextTick((function(){return e.$refs.activityInput.focus()})):this.$nextTick((function(){return e.$refs.idNumberInput.focus()}))}}},D=(a("QoXX"),a("KHd+"));function S(t,e,a,r,i,s,n){try{var o=t[s](n),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(r,i)}function C(t){return function(){var e=this,a=arguments;return new Promise((function(r,i){var s=t.apply(e,a);function n(t){S(s,r,i,n,o,"next",t)}function o(t){S(s,r,i,n,o,"throw",t)}n(void 0)}))}}var V={components:{RegisterVisitorForm:Object(D.a)(w,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("validation-observer",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(e){var r=e.handleSubmit;return[a("b-form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),r(t.onSubmit)}}},[a("b-form-row",[a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.first_name"),vid:"first_name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{staticClass:"required-marker",attrs:{label:t.$t("app.first_name"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"firstNameInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.first_name,callback:function(e){t.$set(t.formData,"first_name",e)},expression:"formData.first_name"}})],1)]}}],null,!0)})],1),t._v(" "),a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.last_name"),vid:"last_name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{staticClass:"required-marker",attrs:{label:t.$t("app.last_name"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.last_name,callback:function(e){t.$set(t.formData,"last_name",e)},expression:"formData.last_name"}})],1)]}}],null,!0)})],1)],1),t._v(" "),a("b-form-row",[a("b-col",{staticClass:"pr-3",attrs:{cols:"auto"}},[a("b-form-group",{attrs:{label:t.$t("app.type")}},[a("b-form-radio-group",{attrs:{options:t.types,stacked:""},on:{change:t.changeType},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}})],1)],1),t._v(" "),"visitor"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.id_number"),vid:"id_number",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("app.id_number"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"idNumberInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.id_number,callback:function(e){t.$set(t.formData,"id_number",e)},expression:"formData.id_number"}})],1)]}}],null,!0)})],1):t._e(),t._v(" "),"visitor"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.place_of_residence"),vid:"place_of_residence",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("app.place_of_residence"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.place_of_residence,callback:function(e){t.$set(t.formData,"place_of_residence",e)},expression:"formData.place_of_residence"}})],1)]}}],null,!0)})],1):t._e(),t._v(" "),"participant"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("visitors.activity_program"),vid:"activity",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("visitors.activity_program"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"activityInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.activity,callback:function(e){t.$set(t.formData,"activity",e)},expression:"formData.activity"}})],1)]}}],null,!0)})],1):t._e(),t._v(" "),"staff"==t.formData.type||"external"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.organization"),vid:"organization",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("app.organization"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"organizationInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.organization,callback:function(e){t.$set(t.formData,"organization",e)},expression:"formData.organization"}})],1)]}}],null,!0)})],1):t._e()],1),t._v(" "),a("p",[a("b-button",{attrs:{variant:"primary",type:"submit",disabled:t.isDisabled}},[a("font-awesome-icon",{attrs:{icon:"check"}}),t._v("\n                "+t._s(t.$t("app.register"))+"\n            ")],1),t._v(" "),a("b-button",{attrs:{variant:"secondary",type:"button",disabled:t.isDisabled},on:{click:t.reset}},[a("font-awesome-icon",{attrs:{icon:"eraser"}}),t._v("\n                "+t._s(t.$t("app.reset"))+"\n            ")],1)],1)],1)]}}])})}),[],!1,null,null,null).exports,BaseTable:a("D52m").a},data:function(){var t=this;return{isBusy:!1,showRegisterForm:!1,fields:[{key:"last_name",label:this.$t("app.last_name"),sortable:!0,tdClass:"align-middle"},{key:"first_name",label:this.$t("app.first_name"),sortable:!0,tdClass:"align-middle"},{key:"type",label:this.$t("app.type"),tdClass:"align-middle",formatter:this.getTypeLabel},{key:"additional_info",label:this.$t("app.additional_info"),tdClass:"align-middle",formatter:function(e,a,r){var i=Array();return r.id_number&&i.push("".concat(t.$t("app.id_number"),": ").concat(r.id_number)),r.place_of_residence&&i.push("".concat(t.$t("app.place_of_residence"),": ").concat(r.place_of_residence)),r.activity&&i.push("".concat(t.$t("visitors.activity_program"),": ").concat(r.activity)),r.organization&&i.push("".concat(t.$t("app.organization"),": ").concat(r.organization)),i.join(", ")}},{key:"entered_at",label:this.$t("app.time"),sortable:!0,sortDirection:"desc",tdClass:"align-middle",formatter:function(t){return f()(t).format("HH:mm")},class:"fit"},{key:"checkout",label:this.$t("app.checkout"),class:"fit"}],currentlyVisiting:{}}},computed:{count:function(){return Object.values(this.currentlyVisiting).reduce((function(t,e){return t+e}),0)}},methods:{fetchData:function(t){return C(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_(t));case 1:case"end":return e.stop()}}),e)})))()},registerVisitor:function(t){var e=this;return C(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.isBusy=!0,a.prev=1,a.next=4,h(t);case 4:Object(d.a)(e.$t("app.checked_in")),e.isBusy=!1,e.$refs.table.refresh(),a.next=13;break;case 9:a.prev=9,a.t0=a.catch(1),alert(a.t0),e.isBusy=!1;case 13:case"end":return a.stop()}}),a,null,[[1,9]])})))()},checkoutVisitor:function(t){var e=this;return C(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.isBusy=!0,a.prev=1,a.next=4,y(t);case 4:e.isBusy=!1,Object(d.a)(e.$t("app.checked_out")),e.$refs.table.refresh(),a.next=13;break;case 9:a.prev=9,a.t0=a.catch(1),alert(a.t0),e.isBusy=!1;case 13:case"end":return a.stop()}}),a,null,[[1,9]])})))()},checkoutAll:function(){var t=this;return C(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm(t.$t("app.really_checkout_everyone"))){e.next=14;break}return t.isBusy=!0,e.prev=2,e.next=5,g();case 5:t.isBusy=!1,Object(d.a)(t.$t("app.everyone_checked_out")),t.$refs.table.refresh(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),alert(e.t0),t.isBusy=!1;case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))()},getTypeLabel:function(t){return"visitor"==t?this.$t("visitors.visitor"):"visitors"==t?this.$t("visitors.visitors"):"participant"==t?this.$t("visitors.participant"):"participants"==t?this.$t("visitors.participants"):"staff"==t?this.$t("visitors.volunteer_staff"):"external"==t?this.$t("visitors.external_visitor"):t}}},j=Object(D.a)(V,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{staticClass:"px-0",attrs:{fluid:"md"}},[t.showRegisterForm?a("b-card",{staticClass:"mb-4",attrs:{"body-class":"pb-0","header-class":"d-flex justify-content-between"},scopedSlots:t._u([{key:"header",fn:function(){return[a("span",[t._v(t._s(t.$t("app.check_in")))]),t._v(" "),a("b-button",{attrs:{variant:"link",size:"sm"},on:{click:function(e){t.showRegisterForm=!1}}},[a("font-awesome-icon",{attrs:{icon:"times"}})],1)]},proxy:!0}],null,!1,73468494)},[t._v(" "),a("register-visitor-form",{attrs:{disabled:t.isBusy},on:{submit:t.registerVisitor}})],1):t._e(),t._v(" "),t.showRegisterForm?t._e():a("b-row",{staticClass:"mb-4"},[a("b-col",[a("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.showRegisterForm=!0}}},[a("font-awesome-icon",{attrs:{icon:"sign-in-alt"}}),t._v("\n                "+t._s(t.$t("app.check_in"))+"\n            ")],1)],1),t._v(" "),a("b-col",{staticClass:"text-right"},[a("b-dropdown",{staticClass:"d-block d-md-none",attrs:{right:"",text:t.$t("app.actions")}},[0!==t.count?a("b-dropdown-item",{on:{click:t.checkoutAll}},[a("font-awesome-icon",{attrs:{icon:"door-closed"}}),t._v("\n                    "+t._s(t.$t("app.checkout_everyone"))+"\n                ")],1):t._e(),t._v(" "),a("b-dropdown-item",{attrs:{to:{name:"visitors.report"}}},[a("font-awesome-icon",{attrs:{icon:"chart-bar"}}),t._v("\n                    "+t._s(t.$t("app.report"))+"\n                ")],1)],1),t._v(" "),a("span",{staticClass:"d-none d-md-inline"},[a("b-button",{attrs:{variant:"secondary",to:{name:"visitors.report"}}},[a("font-awesome-icon",{attrs:{icon:"chart-bar"}}),t._v("\n                    "+t._s(t.$t("app.report"))+"\n                ")],1),t._v(" "),0!==t.count?a("b-button",{attrs:{variant:"secondary",disabled:t.isBusy},on:{click:t.checkoutAll}},[a("font-awesome-icon",{attrs:{icon:"door-closed"}}),t._v("\n                    "+t._s(t.$t("app.checkout_everyone"))+"\n                ")],1):t._e()],1)],1)],1),t._v(" "),a("h3",[t._v(t._s(t.$t("visitors.current_visitors")))]),t._v(" "),a("p",{staticClass:"text-muted"},[t._l(t.currentlyVisiting,(function(e,r){return a("span",{key:r},[t._v("\n            "+t._s(t.getTypeLabel(r))+": "),a("strong",[t._v(t._s(e))]),t._v(",\n        ")])})),t._v("\n        "+t._s(t.$t("app.total"))+": "),a("strong",[t._v(t._s(t.count))])],2),t._v(" "),a("base-table",{ref:"table",attrs:{id:"visitors-table",fields:t.fields,"api-method":t.fetchData,"default-sort-by":"entered_at","default-sort-desc":"","empty-text":t.$t("app.no_data_registered"),"items-per-page":100},on:{metadata:function(e){t.currentlyVisiting=e.currently_visiting}},scopedSlots:t._u([{key:"cell(checkout)",fn:function(e){return[a("b-button",{attrs:{size:"sm",variant:"primary",disabled:t.isBusy},on:{click:function(a){return t.checkoutVisitor(e.item.id)}}},[a("font-awesome-icon",{attrs:{icon:"sign-out-alt"}}),t._v("\n                "+t._s(t.$t("app.checkout"))+"\n            ")],1)]}}])})],1)}),[],!1,null,null,null).exports;function O(t,e,a,r,i,s,n){try{var o=t[s](n),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(r,i)}function z(t){return function(){var e=this,a=arguments;return new Promise((function(r,i){var s=t.apply(e,a);function n(t){O(s,r,i,n,o,"next",t)}function o(t){O(s,r,i,n,o,"throw",t)}n(void 0)}))}}var B={components:{},data:function(){return{dailyFields:[{key:"day",label:this.$t("app.date")},{key:"visitors",label:this.$t("visitors.visitors"),class:"text-right"},{key:"participants",label:this.$t("visitors.participants"),class:"text-right"},{key:"staff",label:this.$t("visitors.volunteers_staff"),class:"text-right"},{key:"external",label:this.$t("visitors.external_visitors"),class:"text-right"},{key:"total",label:this.$t("app.total"),class:"text-right"}],monthlyFields:[{key:"date",label:this.$t("app.date"),formatter:function(t,e,a){return f()({year:a.year,month:a.month-1}).format("MMMM YYYY")}},{key:"visitors",label:this.$t("visitors.visitors"),class:"text-right"},{key:"participants",label:this.$t("visitors.participants"),class:"text-right"},{key:"staff",label:this.$t("visitors.volunteers_staff"),class:"text-right"},{key:"external",label:this.$t("visitors.external_visitors"),class:"text-right"},{key:"total",label:this.$t("app.total"),class:"text-right"}]}},methods:{dailyitemProvider:function(t){return z(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k();case 2:return e=t.sent,t.abrupt("return",e||[]);case 4:case"end":return t.stop()}}),t)})))()},monthlyItemProvider:function(t){return z(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$();case 2:return e=t.sent,t.abrupt("return",e||[]);case 4:case"end":return t.stop()}}),t)})))()}}},F=Object(D.a)(B,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",[a("p",{staticClass:"text-right"},[a("b-button",{attrs:{variant:"secondary",to:{name:"visitors.listCurrent"}}},[a("font-awesome-icon",{attrs:{icon:"arrow-left"}}),t._v("\n            "+t._s(t.$t("app.back"))+"\n        ")],1)],1),t._v(" "),a("h3",[t._v(t._s(t.$t("visitors.visitors_by_day")))]),t._v(" "),a("b-table",{attrs:{items:t.dailyitemProvider,fields:t.dailyFields,striped:"",hover:"",small:"",bordered:"",responsive:"","show-empty":!0,"empty-text":t.$t("app.no_data_registered"),caption:t.$t("app.showing_latest_n_active_days",{days:30})}},[a("div",{staticClass:"text-center my-2",attrs:{slot:"table-busy"},slot:"table-busy"},[a("b-spinner",{staticClass:"align-middle"}),t._v(" "),a("strong",[t._v(t._s(t.$t("app.loading")))])],1)]),t._v(" "),a("h3",[t._v(t._s(t.$t("visitors.visitors_by_month")))]),t._v(" "),a("b-table",{attrs:{items:t.monthlyItemProvider,fields:t.monthlyFields,striped:"",hover:"",small:"",bordered:"",responsive:"","show-empty":!0,"empty-text":t.$t("app.no_data_registered")}},[a("div",{staticClass:"text-center my-2",attrs:{slot:"table-busy"},slot:"table-busy"},[a("b-spinner",{staticClass:"align-middle"}),t._v(" "),a("strong",[t._v(t._s(t.$t("app.loading")))])],1)])],1)}),[],!1,null,null,null).exports,I=a("E4rW");i.a.use(c.a);var E=new c.a({mode:"history",base:"/visitors/",routes:[{path:"/",redirect:{name:"visitors.listCurrent"}},{path:"/current",name:"visitors.listCurrent",components:{default:j}},{path:"/report",name:"visitors.report",components:{default:F}},{path:"*",component:I.a}]}),P=(a("l/fe"),a("UvZm")),T=Object(D.a)({},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-view")],1)}),[],!1,null,null,null).exports;i.a.component("font-awesome-icon",s.a),i.a.use(n.a),i.a.mixin(P.a),i.a.config.productionTip=!1,new i.a({el:"#visitors-app",router:E,i18n:o.a,components:{VisitorsApp:T}})},QEZK:function(t,e,a){(t.exports=a("I1BE")(!1)).push([t.i,'.required-marker legend:after{content:"*";color:red;margin-left:3px}',""])},QObt:function(t,e,a){var r=a("QEZK");"string"==typeof r&&(r=[[t.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(r,i);r.locals&&(t.exports=r.locals)},QoXX:function(t,e,a){"use strict";a("QObt")}},[[3,0,1]]]);
//# sourceMappingURL=visitors.js.map