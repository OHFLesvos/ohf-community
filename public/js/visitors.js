(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{3:function(t,e,a){t.exports=a("J/+j")},"J/+j":function(t,e,a){"use strict";a.r(e);var i=a("XuX8"),r=a.n(i),s=a("1QPe"),n=a("X1uE"),o=a("fxIy"),c=a("jE9Z"),l=a("o0o1"),u=a.n(l),f=a("wd/R"),p=a.n(f),d=a("K9XY"),m=a("8D1c"),v=a("eQ0E"),b={props:{disabled:Boolean},mixins:[v.a],data:function(){return{formData:this.initialFormData(),types:[{value:"visitor",text:this.$t("visitors.visitor")},{value:"participant",text:this.$t("visitors.participant")},{value:"staff",text:this.$t("visitors.volunteer_staff")},{value:"external",text:this.$t("visitors.external_visitor")}]}},computed:{isDisabled:function(){return this.disabled}},watch:{disabled:function(t,e){var a=this;!t&&e&&this.$nextTick((function(){return a.selectFirstName()}))}},mounted:function(){this.focus()},methods:{submit:function(){var t=this;this.$refs.observer.validate().then((function(e){e&&t.onSubmit()}))},onSubmit:function(){"visitor"==this.formData.type?(this.formData.activity="",this.formData.organization=""):"participant"==this.formData.type?(this.formData.id_number="",this.formData.place_of_residence="",this.formData.organization=""):"staff"!=this.formData.type&&"external"!=this.formData.type||(this.formData.id_number="",this.formData.place_of_residence="",this.formData.activity=""),this.$emit("submit",this.formData)},reset:function(){this.formData=this.initialFormData(),this.$refs.observer.reset(),this.focus()},initialFormData:function(){return{first_name:"",last_name:"",type:"visitor",id_number:"",place_of_residence:"",activity:"",organization:""}},focus:function(){this.$refs.firstNameInput.focus()},selectFirstName:function(){this.$refs.firstNameInput.select()},changeType:function(t){var e=this;"staff"==t||"external"==t?this.$nextTick((function(){return e.$refs.organizationInput.focus()})):"participant"==t?this.$nextTick((function(){return e.$refs.activityInput.focus()})):this.$nextTick((function(){return e.$refs.idNumberInput.focus()}))}}},_=(a("QoXX"),a("KHd+"));function h(t,e,a,i,r,s,n){try{var o=t[s](n),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(i,r)}function y(t){return function(){var e=this,a=arguments;return new Promise((function(i,r){var s=t.apply(e,a);function n(t){h(s,i,r,n,o,"next",t)}function o(t){h(s,i,r,n,o,"throw",t)}n(void 0)}))}}var g={components:{RegisterVisitorForm:Object(_.a)(b,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("validation-observer",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(e){var i=e.handleSubmit;return[a("b-form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),i(t.onSubmit)}}},[a("b-form-row",[a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.first_name"),vid:"first_name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{staticClass:"required-marker",attrs:{label:t.$t("app.first_name"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"firstNameInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.first_name,callback:function(e){t.$set(t.formData,"first_name",e)},expression:"formData.first_name"}})],1)]}}],null,!0)})],1),t._v(" "),a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.last_name"),vid:"last_name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{staticClass:"required-marker",attrs:{label:t.$t("app.last_name"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.last_name,callback:function(e){t.$set(t.formData,"last_name",e)},expression:"formData.last_name"}})],1)]}}],null,!0)})],1)],1),t._v(" "),a("b-form-row",[a("b-col",{staticClass:"pr-3",attrs:{cols:"auto"}},[a("b-form-group",{attrs:{label:t.$t("app.type")}},[a("b-form-radio-group",{attrs:{options:t.types,stacked:""},on:{change:t.changeType},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}})],1)],1),t._v(" "),"visitor"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.id_number"),vid:"id_number",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("app.id_number"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"idNumberInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.id_number,callback:function(e){t.$set(t.formData,"id_number",e)},expression:"formData.id_number"}})],1)]}}],null,!0)})],1):t._e(),t._v(" "),"visitor"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.place_of_residence"),vid:"place_of_residence",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("app.place_of_residence"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.place_of_residence,callback:function(e){t.$set(t.formData,"place_of_residence",e)},expression:"formData.place_of_residence"}})],1)]}}],null,!0)})],1):t._e(),t._v(" "),"participant"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("visitors.activity_program"),vid:"activity",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("visitors.activity_program"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"activityInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.activity,callback:function(e){t.$set(t.formData,"activity",e)},expression:"formData.activity"}})],1)]}}],null,!0)})],1):t._e(),t._v(" "),"staff"==t.formData.type||"external"==t.formData.type?a("b-col",{attrs:{sm:""}},[a("validation-provider",{attrs:{name:t.$t("app.organization"),vid:"organization",rules:{}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-form-group",{attrs:{label:t.$t("app.organization"),state:t.getValidationState(e),"invalid-feedback":e.errors[0]}},[a("b-form-input",{ref:"organizationInput",attrs:{trim:"",autocomplete:"off",state:t.getValidationState(e),disabled:t.isDisabled},model:{value:t.formData.organization,callback:function(e){t.$set(t.formData,"organization",e)},expression:"formData.organization"}})],1)]}}],null,!0)})],1):t._e()],1),t._v(" "),a("p",[a("b-button",{attrs:{variant:"primary",type:"submit",disabled:t.isDisabled}},[a("font-awesome-icon",{attrs:{icon:"check"}}),t._v("\n                "+t._s(t.$t("app.register"))+"\n            ")],1),t._v(" "),a("b-button",{attrs:{variant:"secondary",type:"button",disabled:t.isDisabled},on:{click:t.reset}},[a("font-awesome-icon",{attrs:{icon:"eraser"}}),t._v("\n                "+t._s(t.$t("app.reset"))+"\n            ")],1)],1)],1)]}}])})}),[],!1,null,null,null).exports,BaseTable:a("D52m").a},data:function(){var t=this;return{isBusy:!1,showRegisterForm:!1,fields:[{key:"last_name",label:this.$t("app.last_name"),sortable:!0,tdClass:"align-middle"},{key:"first_name",label:this.$t("app.first_name"),sortable:!0,tdClass:"align-middle"},{key:"type",label:this.$t("app.type"),tdClass:"align-middle",formatter:this.getTypeLabel},{key:"additional_info",label:this.$t("app.additional_info"),tdClass:"align-middle",formatter:function(e,a,i){var r=Array();return i.id_number&&r.push("".concat(t.$t("app.id_number"),": ").concat(i.id_number)),i.place_of_residence&&r.push("".concat(t.$t("app.place_of_residence"),": ").concat(i.place_of_residence)),i.activity&&r.push("".concat(t.$t("visitors.activity_program"),": ").concat(i.activity)),i.organization&&r.push("".concat(t.$t("app.organization"),": ").concat(i.organization)),r.join(", ")}},{key:"entered_at",label:this.$t("app.time"),sortable:!0,sortDirection:"desc",tdClass:"align-middle",formatter:function(t){return p()(t).format("HH:mm")},class:"fit"},{key:"checkout",label:this.$t("app.checkout"),class:"fit"}],currentlyVisiting:{}}},computed:{count:function(){return Object.values(this.currentlyVisiting).reduce((function(t,e){return t+e}),0)}},methods:{fetchData:function(t){return y(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.a.listCurrent(t));case 1:case"end":return e.stop()}}),e)})))()},registerVisitor:function(t){var e=this;return y(u.a.mark((function a(){return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.isBusy=!0,a.prev=1,a.next=4,m.a.checkin(t);case 4:Object(d.a)(e.$t("app.checked_in")),e.isBusy=!1,e.$refs.table.refresh(),a.next=13;break;case 9:a.prev=9,a.t0=a.catch(1),alert(a.t0),e.isBusy=!1;case 13:case"end":return a.stop()}}),a,null,[[1,9]])})))()},checkoutVisitor:function(t){var e=this;return y(u.a.mark((function a(){return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.isBusy=!0,a.prev=1,a.next=4,m.a.checkout(t);case 4:e.isBusy=!1,Object(d.a)(e.$t("app.checked_out")),e.$refs.table.refresh(),a.next=13;break;case 9:a.prev=9,a.t0=a.catch(1),alert(a.t0),e.isBusy=!1;case 13:case"end":return a.stop()}}),a,null,[[1,9]])})))()},checkoutAll:function(){var t=this;return y(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm(t.$t("app.really_checkout_everyone"))){e.next=14;break}return t.isBusy=!0,e.prev=2,e.next=5,m.a.checkoutAll();case 5:t.isBusy=!1,Object(d.a)(t.$t("app.everyone_checked_out")),t.$refs.table.refresh(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),alert(e.t0),t.isBusy=!1;case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))()},getTypeLabel:function(t){return"visitor"==t?this.$t("visitors.visitor"):"visitors"==t?this.$t("visitors.visitors"):"participant"==t?this.$t("visitors.participant"):"participants"==t?this.$t("visitors.participants"):"staff"==t?this.$t("visitors.volunteer_staff"):"external"==t?this.$t("visitors.external_visitor"):t}}},k=Object(_.a)(g,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{staticClass:"px-0",attrs:{fluid:"md"}},[t.showRegisterForm?a("b-card",{staticClass:"mb-4",attrs:{"body-class":"pb-0","header-class":"d-flex justify-content-between"},scopedSlots:t._u([{key:"header",fn:function(){return[a("span",[t._v(t._s(t.$t("app.check_in")))]),t._v(" "),a("b-button",{attrs:{variant:"link",size:"sm"},on:{click:function(e){t.showRegisterForm=!1}}},[a("font-awesome-icon",{attrs:{icon:"times"}})],1)]},proxy:!0}],null,!1,73468494)},[t._v(" "),a("register-visitor-form",{attrs:{disabled:t.isBusy},on:{submit:t.registerVisitor}})],1):t._e(),t._v(" "),t.showRegisterForm?t._e():a("b-row",{staticClass:"mb-4"},[a("b-col",[a("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.showRegisterForm=!0}}},[a("font-awesome-icon",{attrs:{icon:"sign-in-alt"}}),t._v("\n                "+t._s(t.$t("app.check_in"))+"\n            ")],1)],1),t._v(" "),a("b-col",{staticClass:"text-right"},[a("b-dropdown",{staticClass:"d-block d-md-none",attrs:{right:"",text:t.$t("app.actions")}},[0!==t.count?a("b-dropdown-item",{on:{click:t.checkoutAll}},[a("font-awesome-icon",{attrs:{icon:"door-closed"}}),t._v("\n                    "+t._s(t.$t("app.checkout_everyone"))+"\n                ")],1):t._e()],1),t._v(" "),a("span",{staticClass:"d-none d-md-inline"},[0!==t.count?a("b-button",{attrs:{variant:"secondary",disabled:t.isBusy},on:{click:t.checkoutAll}},[a("font-awesome-icon",{attrs:{icon:"door-closed"}}),t._v("\n                    "+t._s(t.$t("app.checkout_everyone"))+"\n                ")],1):t._e()],1)],1)],1),t._v(" "),a("h3",[t._v(t._s(t.$t("visitors.current_visitors")))]),t._v(" "),a("p",{staticClass:"text-muted"},[t._l(t.currentlyVisiting,(function(e,i){return a("span",{key:i},[t._v("\n            "+t._s(t.getTypeLabel(i))+": "),a("strong",[t._v(t._s(e))]),t._v(",\n        ")])})),t._v("\n        "+t._s(t.$t("app.total"))+": "),a("strong",[t._v(t._s(t.count))])],2),t._v(" "),a("base-table",{ref:"table",attrs:{id:"visitors-table",fields:t.fields,"api-method":t.fetchData,"default-sort-by":"entered_at","default-sort-desc":"","empty-text":t.$t("app.no_data_registered"),"items-per-page":100},on:{metadata:function(e){t.currentlyVisiting=e.currently_visiting}},scopedSlots:t._u([{key:"cell(checkout)",fn:function(e){return[a("b-button",{attrs:{size:"sm",variant:"primary",disabled:t.isBusy},on:{click:function(a){return t.checkoutVisitor(e.item.id)}}},[a("font-awesome-icon",{attrs:{icon:"sign-out-alt"}}),t._v("\n                "+t._s(t.$t("app.checkout"))+"\n            ")],1)]}}])})],1)}),[],!1,null,null,null).exports,$=a("E4rW");r.a.use(c.a);var D=new c.a({mode:"history",base:"/visitors/",routes:[{path:"/",redirect:{name:"visitors.listCurrent"}},{path:"/current",name:"visitors.listCurrent",components:{default:k}},{path:"*",component:$.a}]}),x=(a("l/fe"),a("UvZm")),w=Object(_.a)({},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-view")],1)}),[],!1,null,null,null).exports;r.a.component("font-awesome-icon",s.a),r.a.use(n.a),r.a.mixin(x.a),r.a.config.productionTip=!1,new r.a({el:"#visitors-app",router:D,i18n:o.a,components:{VisitorsApp:w}})},QEZK:function(t,e,a){(t.exports=a("I1BE")(!1)).push([t.i,'.required-marker legend:after{content:"*";color:red;margin-left:3px}',""])},QObt:function(t,e,a){var i=a("QEZK");"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(i,r);i.locals&&(t.exports=i.locals)},QoXX:function(t,e,a){"use strict";a("QObt")}},[[3,0,1]]]);
//# sourceMappingURL=visitors.js.map