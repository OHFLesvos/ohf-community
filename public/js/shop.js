(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"3X7Q":function(e,t,n){"use strict";n("DhYU")},8:function(e,t,n){e.exports=n("U8sU")},DhYU:function(e,t,n){var a=n("nlxH");"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(a,r);a.locals&&(e.exports=a.locals)},U8sU:function(e,t,n){"use strict";n.r(t);var a=n("XuX8"),r=n.n(a),s=n("1QPe"),o=n("o0o1"),i=n.n(o),c=n("K9XY"),d=n("lzA6"),u={extends:n("7H/5").a,data:function(){return{variant:"warning",icon:"exclamation-triangle"}}},l=n("KHd+"),p=Object(l.a)(u,void 0,void 0,!1,null,null,null).exports,v=n("TRA/"),f={components:{FontAwesomeIcon:s.a},props:{handout:{type:Object,required:!0},busy:{type:Boolean,required:!1,default:!1}},data:function(){return{redeeming:!1,cancelling:!1}},computed:{redeemButtonIcon:function(){return this.redeeming?"spinner":"check"},cancelButtonIcon:function(){return this.cancelling?"spinner":"undo"}},watch:{busy:function(e,t){0==e&&1==t&&(this.redeeming=!1,this.cancelling=!1)}},methods:{redeemCard:function(){this.redeeming=!0,this.$emit("redeem")},cancelCard:function(){this.cancelling=!0,this.$emit("cancel")}}},h=Object(l.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card mb-4"},[n("div",{staticClass:"card-header d-flex justify-content-between"},[n("span",[e._v("\n            "+e._s(e.$t("shop.card"))+"\n            "+e._s(e.handout.code_short)+"\n        ")]),e._v(" "),n("span",[n("span",{staticClass:"d-none d-sm-inline"},[e._v("\n                "+e._s(e.$t("shop.registered"))+"\n            ")]),e._v("\n            "+e._s(e.handout.date)+"\n        ")])]),e._v(" "),n("div",{staticClass:"card-body"},[n("div",{staticClass:"row align-items-center"},[n("div",{staticClass:"col mb-4 mb-sm-0"},[n("div",{staticClass:"row align-items-center"},[n("div",{staticClass:"col-auto text-center"},[n("span",{staticClass:"display-4"},["f"==e.handout.person.gender?n("font-awesome-icon",{attrs:{icon:"female"}}):e._e(),e._v(" "),"m"==e.handout.person.gender?n("font-awesome-icon",{attrs:{icon:"male"}}):e._e()],1)]),e._v(" "),n("div",{staticClass:"col"},[e._v("\n                        "+e._s(e.handout.person.fullName)+"\n                        "),n("a",{attrs:{href:e.handout.person.url,target:"_blank"}},[n("font-awesome-icon",{attrs:{icon:"search"}})],1),e._v(" "),n("br"),e._v(" "),e.handout.person.date_of_birth?[e._v("\n                            "+e._s(e.handout.person.date_of_birth)+"\n                            ("+e._s(e.handout.person.age_formatted)+")\n                        ")]:e._e(),e._v(" "),n("br"),e._v(" "),null!=e.handout.person.nationality?[e._v("\n                            "+e._s(e.handout.person.nationality)+"\n                        ")]:e._e(),e._v(" "),e.handout.person.family_members.length>0?e._l(e.handout.person.family_members,(function(t){return n("span",{key:t.fullName},[n("br"),e._v(" "),n("font-awesome-icon",{attrs:{icon:"user-friends"}}),e._v("\n                                "+e._s(t.fullName)+"\n                                ("+e._s(t.age_formatted)+")\n                            ")],1)})):e._e()],2)])]),e._v(" "),n("div",{staticClass:"col-sm-auto text-center"},[null!=e.handout.code_redeemed?n("strong",{staticClass:"text-warning"},[n("font-awesome-icon",{attrs:{icon:"exclamation-triangle"}}),e._v("\n                    "+e._s(e.$t("shop.card_already_redeemed"))+"\n                    "),n("br"),e._v(" "),n("small",[e._v(e._s(e.handout.updated_diff_formatted))])],1):e.handout.expired?n("strong",{staticClass:"text-warning"},[n("font-awesome-icon",{attrs:{icon:"exclamation-triangle"}}),e._v("\n                    "+e._s(e.$t("shop.card_expired"))+"\n                    "),n("br"),e._v(" "),n("small",[e._v(e._s(e.handout.validity_formatted))])],1):[n("button",{staticClass:"btn btn-lg btn-block btn-success",attrs:{type:"submit",disabled:e.busy},on:{click:e.redeemCard}},[n("font-awesome-icon",{attrs:{icon:e.redeemButtonIcon,spin:this.redeeming}}),e._v("\n                        "+e._s(e.$t("shop.redeem"))+"\n                    ")],1),e._v(" "),n("button",{staticClass:"btn btn-sm btn-block btn-outline-danger mt-3",attrs:{type:"submit",disabled:e.busy},on:{click:e.cancelCard}},[n("font-awesome-icon",{attrs:{icon:e.cancelButtonIcon,spin:this.cancelling}}),e._v("\n                        "+e._s(e.$t("shop.cancel_card"))+"\n                    ")],1)]],2)])])])}),[],!1,null,null,null).exports,_=n("GUe+");function m(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}var b={components:{QrcodeStream:n("bRJq").QrcodeStream,BButton:_.a},props:{busy:Boolean,enabled:Boolean,validator:{type:Function,required:!1},validatorMessage:{type:String,required:!1,default:"Invalid input."}},data:function(){return{errorMessage:void 0,loading:!1,isEnabled:this.enabled,camera:"auto",foo:null,isValid:void 0}},computed:{buttonVariant:function(){return this.isEnabled?"warning":"primary"},buttonIcon:function(){return this.isEnabled?"times":"qrcode"},buttonLabel:function(){return this.isEnabled?"Stop scanner":"Enable scanner"},validationSuccess:function(){return!0===this.isValid},validationFailure:function(){return!1===this.isValid}},watch:{isEnabled:function(e,t){e&&!t&&this.$emit("enable"),!e&&t&&this.$emit("disable")}},methods:{onInit:function(e){var t=this;this.loading=!0,this.errorMessage=void 0,this.resetValidationState(),e.catch((function(e){return t.errorMessage=e.message})).then((function(){return t.loading=!1}))},onDecode:function(e){var t,n=this;return(t=i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.turnCameraOff(),t.next=3,n.timeout(500);case 3:return n.isValid=!n.validator||n.validator(e),n.isValid&&n.$emit("decode",e),t.next=7,n.timeout(n.isValid?1e3:2500);case 7:n.turnCameraOn();case 8:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(a,r){var s=t.apply(e,n);function o(e){m(s,a,r,o,i,"next",e)}function i(e){m(s,a,r,o,i,"throw",e)}o(void 0)}))})()},resetValidationState:function(){this.isValid=void 0},turnCameraOn:function(){this.camera="auto"},turnCameraOff:function(){this.camera="off"},timeout:function(e){return new Promise((function(t){return window.setTimeout(t,e)}))}}},g=(n("3X7Q"),Object(l.a)(b,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("p",[n("b-button",{attrs:{variant:e.buttonVariant,block:"",disabled:e.busy},on:{click:function(t){e.isEnabled=!e.isEnabled}}},[n("font-awesome-icon",{attrs:{icon:e.buttonIcon}}),e._v("\n            "+e._s(e.buttonLabel)+"\n        ")],1)],1),e._v(" "),e.isEnabled?n("div",{staticClass:"mb-2"},[n("qrcode-stream",{staticStyle:{width:"100%",height:"100%"},attrs:{camera:e.busy?"off":e.camera},on:{init:e.onInit,decode:e.onDecode}},[e.errorMessage?n("div",{staticClass:"error-message"},[e._v("\n                "+e._s(e.errorMessage)+"\n            ")]):e._e(),e._v(" "),e.loading?n("div",{staticClass:"loading-indicator"},[n("font-awesome-icon",{attrs:{icon:"cog",spin:""}})],1):e._e(),e._v(" "),e.validationSuccess?n("div",{staticClass:"validation-success"},[n("font-awesome-icon",{attrs:{icon:"check"}})],1):e._e(),e._v(" "),e.validationFailure?n("div",{staticClass:"validation-failure"},[e._v("\n                "+e._s(e.validatorMessage)+"\n            ")]):e._e()])],1):e._e()])}),[],!1,null,"6911d0da",null).exports),w=n("o0O0"),x=n("OJ8O");function y(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function o(e){y(s,a,r,o,i,"next",e)}function i(e){y(s,a,r,o,i,"throw",e)}o(void 0)}))}}var k=function(e){return C(i.a.mark((function t(){var n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={code:e},a=Object(x.c)("api.shop.cards.searchByCode",n),t.prev=2,t.next=5,x.a.getNoCatch(a);case 5:return t.abrupt("return",t.sent);case 8:if(t.prev=8,t.t0=t.catch(2),t.t0.response&&404==t.t0.response.status){t.next=13;break}throw console.error(t.t0),Object(x.b)(t.t0);case 13:case"end":return t.stop()}}),t,null,[[2,8]])})))()},$=function(e){return C(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object(x.c)("api.shop.cards.redeem",e),t.next=3,x.a.patch(n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},E=function(e){return C(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object(x.c)("api.shop.cards.cancel",e),t.next=3,x.a.delete(n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},O=function(){return C(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(x.c)("api.shop.cards.listRedeemedToday"),e.next=3,x.a.get(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},j=function(){return C(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(x.c)("api.shop.cards.listNonRedeemedByDay"),e.next=3,x.a.get(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},S=function(e){return C(i.a.mark((function t(){var n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={date:e},a=Object(x.c)("api.shop.cards.deleteNonRedeemedByDay"),t.next=4,x.a.post(a,n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()};function I(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function o(e){I(s,a,r,o,i,"next",e)}function i(e){I(s,a,r,o,i,"throw",e)}o(void 0)}))}}var B={components:{ShopCardDetails:h,ErrorAlert:d.a,WarningAlert:p,InfoAlert:v.a,CardScannerArea:g},data:function(){return{loading:!0,code:null,error:null,handout:null,searching:!1,busy:!1,scannerEnabled:!1}},computed:{idleMessage:function(){return this.scannerEnabled?this.$t("shop.please_scan_next_card"):this.$t("shop.please_enable_scanner_to_scan_cards")}},watch:{code:function(e,t){null!=e&&t!=e&&this.searchCode(e)}},methods:{onDecode:function(e){var t=e.trim();t.length>0&&(this.code=t)},searchCode:function(e){var t=this;return P(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.error=null,t.handout=null,t.busy=!0,t.searching=!0,n.prev=4,n.next=7,k(e);case 7:a=n.sent,t.handout=a?a.data:null,n.next=14;break;case 11:n.prev=11,n.t0=n.catch(4),t.error=n.t0;case 14:t.busy=!1,t.searching=!1;case 16:case"end":return n.stop()}}),n,null,[[4,11]])})))()},redeemCard:function(){var e=this;return P(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.busy=!0,t.prev=1,t.next=4,$(e.handout.id);case 4:n=t.sent,e.code=null,e.handout=null,Object(c.a)(n.message),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e.error=t.t0;case 13:e.busy=!1;case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))()},cancelCard:function(){var e=this;return P(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.confirm(e.$t("shop.should_card_be_cancelled"))){t.next=15;break}return e.busy=!0,t.prev=2,t.next=5,E(e.handout.id);case 5:n=t.sent,e.code=null,e.handout=null,Object(c.a)(n.message),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),e.error=t.t0;case 14:e.busy=!1;case 15:case"end":return t.stop()}}),t,null,[[2,11]])})))()},isAlphaNumeric:w.c}},A=Object(l.a)(B,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.error?n("error-alert",{attrs:{message:e.error}}):e._e(),e._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg"},[n("card-scanner-area",{attrs:{busy:e.searching,validator:e.isAlphaNumeric,"validator-message":e.$t("app.only_letters_and_numbers_allowed"),enabled:e.scannerEnabled},on:{decode:e.onDecode,enable:function(t){e.scannerEnabled=!0},disable:function(t){e.scannerEnabled=!1}}})],1),e._v(" "),n("div",{staticClass:"col-lg"},[null!=e.code&&e.searching?n("info-alert",{attrs:{message:e.$t("app.searching")}}):e._e(),e._v(" "),null==e.code||e.searching?e._e():[null!=e.handout?[null!=e.handout.person?[n("shop-card-details",{attrs:{handout:e.handout,busy:e.busy},on:{redeem:e.redeemCard,cancel:e.cancelCard}})]:n("warning-alert",{attrs:{message:e.$t("shop.person_assigned_to_card_has_been_deleted")}})]:e.error?e._e():n("warning-alert",{attrs:{message:e.$t("shop.card_not_registered")}})],e._v(" "),null==e.code||e.handout&&null!=e.handout.code_redeemed?n("info-alert",{attrs:{message:e.idleMessage}}):e._e()],2)])],1)}),[],!1,null,null,null).exports,q={components:{FontAwesomeIcon:s.a},props:{person:{type:Object,required:!0},prefix:{type:String,required:!1,default:""},suffix:{type:String,required:!1,default:""}}},V={components:{PersonLabel:Object(l.a)(q,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e.prefix.length>0?[e._v(e._s(e.prefix)+":")]:e._e(),e._v(" "),"f"==e.person.gender?n("font-awesome-icon",{attrs:{icon:"female"}}):e._e(),e._v(" "),"m"==e.person.gender?n("font-awesome-icon",{attrs:{icon:"male"}}):e._e(),e._v("\n    "+e._s(e.person.fullName)),e.person.date_of_birth?[e._v(", "+e._s(e.person.date_of_birth)+"\n    ("+e._s(e.person.age_formatted)+")")]:e._e(),e.person.nationality?[e._v(", "+e._s(e.person.nationality))]:e._e(),e._v(" "),e.suffix.length>0?[n("small",{staticClass:"text-muted"},[e._v(e._s(e.$suffix))])]:e._e()],2)}),[],!1,null,null,null).exports},props:{handouts:{type:Array,required:!0},loading:{type:Boolean,required:!1,default:!1}}},M=Object(l.a)(V,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h4",{staticClass:"mb-3"},[e._v("\n        "+e._s(e.$t("shop.redeemed_cards"))+"\n        "),e.handouts.length>0?[e._v("\n            ("+e._s(e.handouts.length)+")\n        ")]:e._e()],2),e._v(" "),e.loading?n("p",[n("font-awesome-icon",{attrs:{icon:"spinner",spin:""}}),e._v("\n        "+e._s(e.$t("app.loading"))+"\n    ")],1):e.handouts.length>0?n("table",{staticClass:"table table-sm table-striped mb-4"},[n("tbody",e._l(e.handouts,(function(t){return n("tr",{key:t.id},[n("td",[n("a",{attrs:{href:t.person.url,target:"_blank"}},[n("person-label",{attrs:{person:t.person}})],1)]),e._v(" "),n("td",[e._v("\n                    "+e._s(t.code_short)+"\n                ")]),e._v(" "),n("td",[e._v(e._s(t.updated_diff_formatted))])])})),0)]):n("p",[n("em",[e._v(e._s(e.$t("shop.no_cards_redeemed_so_far_today")))])])])}),[],!1,null,null,null).exports;function N(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function o(e){N(s,a,r,o,i,"next",e)}function i(e){N(s,a,r,o,i,"throw",e)}o(void 0)}))}}var U={components:{ErrorAlert:d.a},data:function(){return{items:[],error:null,busy:!1}},created:function(){this.loadSummary()},methods:{loadSummary:function(){var e=this;return D(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.busy=!0,e.error=!1,t.prev=2,t.next=5,j();case 5:n=t.sent,e.items=n,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),e.error=t.t0;case 12:e.busy=!1;case 13:case"end":return t.stop()}}),t,null,[[2,9]])})))()},deleteCards:function(e){var t=this;return D(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!window.confirm("Really delete all non-redeemed cards from ".concat(e,"?"))){n.next=15;break}return t.busy=!0,n.prev=2,n.next=5,S(e);case 5:a=n.sent,t.items=t.items.filter((function(t){return t.date!=e})),t.loadSummary(),Object(c.a)(a.message),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(2),t.error=n.t0;case 14:t.busy=!1;case 15:case"end":return n.stop()}}),n,null,[[2,11]])})))()}}};function H(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}var R={components:{ShopCardsList:M,NonExpiredCardsTable:Object(l.a)(U,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h4",{staticClass:"mb-3"},[e._v("\n        "+e._s(e.$t("shop.non_redeemed_cards"))+"\n    ")]),e._v(" "),e.error?n("error-alert",{attrs:{message:e.error}}):e._e(),e._v(" "),e.items.length>0?n("table",{staticClass:"table table-sm table-striped mb-4"},[n("thead",[n("tr",[n("th",[e._v(e._s(e.$t("app.date")))]),e._v(" "),n("th",[e._v(e._s(e.$t("shop.cards")))]),e._v(" "),n("th",[e._v(e._s(e.$t("shop.expired")))]),e._v(" "),n("th",{staticClass:"fit"},[e._v(e._s(e.$t("app.actions")))])])]),e._v(" "),n("tbody",e._l(e.items,(function(t){return n("tr",{key:t.date,class:{"table-warning":t.expired}},[n("td",{staticClass:"align-middle"},[e._v(e._s(t.date))]),e._v(" "),n("td",{staticClass:"align-middle"},[e._v(e._s(t.total))]),e._v(" "),n("td",{staticClass:"align-middle"},[n("font-awesome-icon",{attrs:{icon:t.expired?"check":"times"}})],1),e._v(" "),n("td",{staticClass:"fit"},[n("button",{staticClass:"btn btn-danger btn-sm",attrs:{disabled:e.busy},on:{click:function(n){return e.deleteCards(t.date)}}},[e._v("\n                        "+e._s(e.$t("shop.delete_cards"))+"\n                    ")])])])})),0)]):e.busy?n("p",[n("font-awesome-icon",{attrs:{icon:"spinner",spin:""}}),e._v("\n        "+e._s(e.$t("app.loading"))+"\n    ")],1):n("p",[n("em",[e._v(e._s(e.$t("shop.no_suitable_cards_found")))])])],1)}),[],!1,null,null,null).exports,ErrorAlert:d.a},data:function(){return{loading:!0,error:null,handouts:[]}},created:function(){this.loadHandouts()},methods:{loadHandouts:function(){var e,t=this;return(e=i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O();case 3:n=e.sent,t.handouts=n.data,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.error=e.t0;case 10:t.loading=!1;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function o(e){H(s,a,r,o,i,"next",e)}function i(e){H(s,a,r,o,i,"throw",e)}o(void 0)}))})()}}},T=Object(l.a)(R,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"row"},[t("div",{staticClass:"col-md"},[this.error?t("error-alert",{attrs:{message:this.error}}):this._e(),this._v(" "),t("shop-cards-list",{attrs:{handouts:this.handouts,loading:this.loading}})],1),this._v(" "),t("div",{staticClass:"col-md"},[t("non-expired-cards-table")],1)])}),[],!1,null,null,null).exports,F=n("fxIy");r.a.component("font-awesome-icon",s.a),r.a.config.productionTip=!1,new r.a({el:"#shop-app",i18n:F.a,components:{ShopScannerPage:A,ShopCardManagerPage:T}})},nlxH:function(e,t,n){(e.exports=n("I1BE")(!1)).push([e.i,".error-message[data-v-6911d0da]{color:red}.loading-indicator[data-v-6911d0da]{color:grey}.error-message[data-v-6911d0da],.loading-indicator[data-v-6911d0da],.validation-failure[data-v-6911d0da],.validation-success[data-v-6911d0da]{position:absolute;width:100%;height:100%;background-color:hsla(0,0%,100%,.8);text-align:center;font-weight:700;font-size:1.4rem;padding:10px;display:flex;flex-flow:column nowrap;justify-content:center}.validation-success[data-v-6911d0da]{color:green}.validation-failure[data-v-6911d0da]{color:red}",""])}},[[8,0,1]]]);
//# sourceMappingURL=shop.js.map